<section class="tab embedded-action-cards {{tab.cssClass}}" data-group="primary" data-tab="embeddedActionCards">
  <div class="eventide-sheet__scrollable-container">
    <div class="erps-items-panel">
      <div class="erps-items-panel__section-header">
        {{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.EmbeddedActionCards"}}
      </div>

      {{#if (or groupedActionCards.length ungroupedActionCards.length)}}

        {{! Ungrouped Action Cards }}
        {{#if ungroupedActionCards.length}}
          <div class="erps-action-card-ungrouped">
            <div class="erps-action-card-ungrouped__header">
              <span class="erps-action-card-ungrouped__title">{{localize "EVENTIDE_RP_SYSTEM.Actor.ActionCards.Ungrouped"}}</span>
              <span class="erps-action-card-ungrouped__count">({{ungroupedActionCards.length}})</span>
            </div>
            <div class="erps-action-card-ungrouped__content">
              <table class="erps-data-table erps-data-table--action-cards" data-ungrouped-zone="true">
                <thead class="erps-data-table__header">
                  <tr class="erps-data-table__header-row">
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--name">{{localize 'Name'}}</th>
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--center">{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.EmbeddedItem'}}</th>
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--center">{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.Mode'}}</th>
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--controls">{{localize 'Controls'}}</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each ungroupedActionCards as |actionCard|}}
                    {{> "item/partials/transformation-action-card-row" actionCard=actionCard editable=@root.editable}}
                  {{/each}}
                </tbody>
              </table>
            </div>
          </div>
        {{/if}}

        {{! Grouped Action Cards }}
        {{#each groupedActionCards as |group|}}
          <div class="erps-action-card-group" data-group-id="{{group.id}}">
            <div class="erps-action-card-group__header">
              <div class="erps-action-card-group__drag-handle" data-drag="true" data-document-class="Group" data-group-id="{{group.id}}" title="{{localize 'EVENTIDE_RP_SYSTEM.Actor.ActionCards.DragToReorder'}}">
                <i class="fas fa-grip-vertical"></i>
              </div>
              <input
                type="text"
                class="erps-action-card-group__name"
                value="{{group.name}}"
                data-group-id="{{group.id}}"
                placeholder="{{localize 'EVENTIDE_RP_SYSTEM.Actor.ActionCards.GroupNamePlaceholder'}}"
                {{#unless @root.editable}}disabled{{/unless}}
              />
              <span class="erps-action-card-group__count">({{group.cards.length}})</span>
              {{#if @root.editable}}
                <a class="erps-action-card-group__delete-button" data-action="deleteGroup" data-group-id="{{group.id}}" title="{{localize 'EVENTIDE_RP_SYSTEM.Actor.ActionCards.DeleteGroup'}}">
                  <i class="fas fa-trash"></i>
                </a>
              {{/if}}
            </div>
            <div class="erps-action-card-group__content">
              <table class="erps-data-table erps-data-table--action-cards">
                <thead class="erps-data-table__header">
                  <tr class="erps-data-table__header-row">
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--name">{{localize 'Name'}}</th>
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--center">{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.EmbeddedItem'}}</th>
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--center">{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.Mode'}}</th>
                    <th class="erps-data-table__header-cell erps-data-table__header-cell--controls">{{localize 'Controls'}}</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each group.cards as |actionCard|}}
                    {{> "item/partials/transformation-action-card-row" actionCard=actionCard editable=@root.editable}}
                  {{/each}}
                </tbody>
              </table>
            </div>
          </div>
        {{/each}}

      {{else}}
        <div class="erps-items-panel__empty">{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.NoActionCards"}}</div>
      {{/if}}

      <div class="erps-items-panel__drop-zone" data-drop-zone="actionCard">
        <p>{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.DropActionCardHere"}}</p>
      </div>

      {{!-- Action buttons section --}}
      <div class="erps-items-panel__actions">
        <div class="erps-form-actions">
          <button type="button" class="erps-button erps-button--secondary" data-action="createNewActionCard" title="{{localize 'EVENTIDE_RP_SYSTEM.CreationButtons.CreateNew'}}">
            <i class="fas fa-plus"></i> {{localize "EVENTIDE_RP_SYSTEM.CreationButtons.CreateNewActionCard"}}
          </button>
        </div>

        {{!-- Search and add existing action cards --}}
        <div class="erps-form-group">
          <label class="erps-form-label">{{localize "EVENTIDE_RP_SYSTEM.Forms.AddExisting"}}</label>
          <div class="erps-item-selector" data-selector="action-cards"></div>
        </div>
      </div>

      <div class="erps-items-panel__notes">
        <p>{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.ActionCardNotes"}}</p>
        <p><strong>{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.DragNote"}}</strong></p>
      </div>
    </div>
  </div>
</section>
