<section class="tab embedded-action-cards {{tab.cssClass}}" data-group="primary" data-tab="embeddedActionCards">
  <div class="eventide-sheet__scrollable-container">
    <div class="erps-items-panel">
      <div class="erps-items-panel__section-header">
        {{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.EmbeddedActionCards"}}
      </div>

      {{#if (or groupedActionCards.length ungroupedActionCards.length)}}

        {{! Ungrouped Action Cards }}
        {{#if ungroupedActionCards.length}}
          <div class="erps-items-panel__section-subheader">
            {{localize "EVENTIDE_RP_SYSTEM.Actor.ActionCards.Ungrouped"}}
          </div>
          <ol class="erps-items-panel__list erps-items-panel__list--five-column" data-ungrouped-zone="true">
            <li class="erps-items-panel__item erps-items-panel__item--header">
              <div class="erps-items-panel__cell erps-items-panel__cell--image">{{localize 'Image'}}</div>
              <div class='erps-items-panel__cell erps-items-panel__cell--name'>{{localize 'Name'}}</div>
              <div class='erps-items-panel__cell erps-items-panel__cell--center'>{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.EmbeddedItem'}}</div>
              <div class='erps-items-panel__cell erps-items-panel__cell--center'>{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.Mode'}}</div>
              <div class='erps-items-panel__cell erps-items-panel__cell--controls'>{{localize 'Controls'}}</div>
            </li>
            {{#each ungroupedActionCards as |actionCard|}}
              {{> "item/partials/transformation-action-card-row" actionCard=actionCard editable=@root.editable}}
            {{/each}}
          </ol>
        {{/if}}

        {{! Grouped Action Cards }}
        {{#each groupedActionCards as |group|}}
          <div class="erps-action-card-group" data-group-id="{{group.id}}">
            <div class="erps-action-card-group__header">
              <div class="erps-action-card-group__drag-handle" data-drag="true" data-document-class="Group" data-group-id="{{group.id}}" title="{{localize 'EVENTIDE_RP_SYSTEM.Actor.ActionCards.DragToReorder'}}">
                <i class="fas fa-grip-vertical"></i>
              </div>
              <input
                type="text"
                class="erps-action-card-group__name"
                value="{{group.name}}"
                data-group-id="{{group.id}}"
                placeholder="{{localize 'EVENTIDE_RP_SYSTEM.Actor.ActionCards.GroupNamePlaceholder'}}"
                {{#unless @root.editable}}disabled{{/unless}}
              />
              <span class="erps-action-card-group__count">({{group.cards.length}})</span>
              {{#if @root.editable}}
                <a class="erps-action-card-group__delete-button" data-action="deleteGroup" data-group-id="{{group.id}}" title="{{localize 'EVENTIDE_RP_SYSTEM.Actor.ActionCards.DeleteGroup'}}">
                  <i class="fas fa-trash"></i>
                </a>
              {{/if}}
            </div>
            <div class="erps-action-card-group__content">
              <ol class="erps-items-panel__list erps-items-panel__list--five-column">
                <li class="erps-items-panel__item erps-items-panel__item--header">
                  <div class="erps-items-panel__cell erps-items-panel__cell--image">{{localize 'Image'}}</div>
                  <div class='erps-items-panel__cell erps-items-panel__cell--name'>{{localize 'Name'}}</div>
                  <div class='erps-items-panel__cell erps-items-panel__cell--center'>{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.EmbeddedItem'}}</div>
                  <div class='erps-items-panel__cell erps-items-panel__cell--center'>{{localize 'EVENTIDE_RP_SYSTEM.Item.ActionCard.Mode'}}</div>
                  <div class='erps-items-panel__cell erps-items-panel__cell--controls'>{{localize 'Controls'}}</div>
                </li>
                {{#each group.cards as |actionCard|}}
                  {{> "item/partials/transformation-action-card-row" actionCard=actionCard editable=@root.editable}}
                {{/each}}
              </ol>
            </div>
          </div>
        {{/each}}

      {{else}}
        <div class="erps-items-panel__empty">{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.NoActionCards"}}</div>
      {{/if}}

      <div class="erps-items-panel__drop-zone" data-drop-zone="actionCard">
        <p>{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.DropActionCardHere"}}</p>
      </div>

      {{!-- Action buttons section --}}
      <div class="erps-items-panel__actions">
        <div class="erps-form-actions">
          <button type="button" class="erps-button erps-button--secondary" data-action="createNewActionCard" title="{{localize 'EVENTIDE_RP_SYSTEM.CreationButtons.CreateNew'}}">
            <i class="fas fa-plus"></i> {{localize "EVENTIDE_RP_SYSTEM.CreationButtons.CreateNewActionCard"}}
          </button>
        </div>

        {{!-- Search and add existing action cards --}}
        <div class="erps-form-group">
          <label class="erps-form-label">{{localize "EVENTIDE_RP_SYSTEM.Forms.AddExisting"}}</label>
          <div class="erps-item-selector" data-selector="action-cards"></div>
        </div>
      </div>

      <div class="erps-items-panel__notes">
        <p>{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.ActionCardNotes"}}</p>
        <p><strong>{{localize "EVENTIDE_RP_SYSTEM.Item.Transformation.DragNote"}}</strong></p>
      </div>
    </div>
  </div>
</section>
