<section class="tab effects {{tab.cssClass}}" data-group="primary" data-tab="characterEffects">
  <div class="eventide-item-sheet__scrollable-container">
    <label class="eventide-item-sheet__effect-toggle-label" for="effect.displayOnToken">Icon Displayed On Token</label>
    <label 
      class="" 
      title="When enabled, this effect will be displayed on tokens">
      <div class="toggle-switch-wrapper">
      <input 
        type="checkbox" 
        class="base-form__toggle-switch-left" 
        name="effect.displayOnToken" 
        id="effect.displayOnToken"
        {{#if activeEffect.duration.seconds}}checked{{/if}}
        data-action="toggleEffectDisplay"
      >
      <label class="toggle-switch-display" for="effect.displayOnToken"></label>
    </div>
    <span 
      class="eventide-item-sheet__effect-toggle-label"
    >
      
    </span>
  </label>

  <div>
    <div class="base-form__color-picker-with-hex color-picker-with-hex">
      <label class="color-picker-label" for="color-iconTint">{{{localize "EVENTIDE_RP_SYSTEM.Forms.Sections.IconTint"}}}:</label>
      <div class="color-picker-container">
        <div class="color-preview" id="preview-iconTint" style="background-color: {{iconTint}}"></div>
        <input type="color" class="color-picker" id="color-iconTint" name="iconTint" value="{{iconTint}}">
        <input type="text" class="hex-input" id="hex-iconTint" placeholder="Hex color" value="{{iconTint}}">
      </div>
    </div>
  </div>

  
    {{! Regular Effects Section }}
    <div class="eventide-item-sheet__effects-section">
      <h3 class="eventide-item-sheet__effects-section-header">
        Regular Effects ({{characterEffects.regularEffects.length}})
      </h3>
      
      <div class="eventide-item-sheet__effects-grid">
        <div class="eventide-item-sheet__effects-grid-header">
          <div class="eventide-item-sheet__effects-grid-cell">Attribute</div>
          <div class="eventide-item-sheet__effects-grid-cell">Mode</div>
          <div class="eventide-item-sheet__effects-grid-cell">Value</div>
          <div class="eventide-item-sheet__effects-grid-cell">Actions</div>
        </div>
        
        {{#each characterEffects.regularEffects}}
          <div class="eventide-item-sheet__effects-grid-row">
            <div class="eventide-item-sheet__effects-grid-cell">
              <select 
                name="characterEffects.regularEffects.{{@index}}.ability"
                data-index="{{@index}}"
                data-type="visible"
              >
                {{#each ../config.abilities as |label key|}}
                  <option value="{{key}}" {{#if (eq ../ability key)}}selected{{/if}}>
                    {{localize label}}
                  </option>
                {{/each}}
              </select>
            </div>
            
            <div class="eventide-item-sheet__effects-grid-cell">
              <select 
                name="characterEffects.regularEffects.{{@index}}.mode"
                data-index="{{@index}}"
                data-type="visible"
              >
                <option value="add" {{#if (eq mode "change")}}selected{{/if}}>Add</option>
                <option value="override" {{#if (eq mode "override")}}selected{{/if}}>Override</option>
                <option value="advantage" {{#if (eq mode "advantage")}}selected{{/if}}>Advantage</option>
                <option value="disadvantage" {{#if (eq mode "disadvantage")}}selected{{/if}}>Disadvantage</option>
              </select>
            </div>
            
            <div class="eventide-item-sheet__effects-grid-cell">
              <div class="base-form__number-input-wrapper">
                <button type="button" class="decrement" data-action="decrementEffect" data-index="{{@index}}" data-type="visible">−</button>
                <input 
                  type="number" 
                  class="base-form__number-input"
                  name="characterEffects.regularEffects.{{@index}}.value" 
                  value="{{value}}" 
                  step="1"
                  data-index="{{@index}}"
                  data-type="visible"
                >
                <button type="button" class="increment" data-action="incrementEffect" data-index="{{@index}}" data-type="visible">+</button>
              </div>
            </div>
            
            <div class="eventide-item-sheet__effects-grid-cell">
              <button 
                type="button" 
                class="eventide-item-sheet__effect-remove"
                data-action="deleteCharacterEffect" 
                data-index="{{@index}}"
                data-type="regularEffects"
                title="Remove effect"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        {{/each}}
      </div>
      
      <div class="eventide-item-sheet__effect-controls">
        <button 
          type="button" 
          class="eventide-item-sheet__add-effect"
          data-action="newCharacterEffect" 
          data-type="abilities"
          data-ability="acro"
          title="Add new effect"
        >
          <i class="fas fa-plus"></i> Add Effect
        </button>
      </div>
    </div>
    
    {{! Hidden Effects Section }}
    {{#if isGM}}
      <div class="eventide-item-sheet__effects-section eventide-item-sheet__effects-section--hidden">
        <h3 class="eventide-item-sheet__effects-section-header">
          Hidden Effects ({{characterEffects.hiddenEffects.length}})
        </h3>
        
        <div class="eventide-item-sheet__effects-grid">
          <div class="eventide-item-sheet__effects-grid-header">
            <div class="eventide-item-sheet__effects-grid-cell">Attribute</div>
            <div class="eventide-item-sheet__effects-grid-cell">Mode</div>
            <div class="eventide-item-sheet__effects-grid-cell">Value</div>
            <div class="eventide-item-sheet__effects-grid-cell">Actions</div>
          </div>
          
          {{#each characterEffects.hiddenEffects}}
            <div class="eventide-item-sheet__effects-grid-row eventide-item-sheet__effects-grid-row--hidden">
              <div class="eventide-item-sheet__effects-grid-cell">
                <select 
                  name="characterEffects.hiddenEffects.{{@index}}.ability"
                  data-index="{{@index}}"
                  data-type="hiddenEffects"
                >
                  {{#each ../config.hiddenAbilities as |label key|}}
                    <option value="{{key}}" {{#if (eq ../ability key)}}selected{{/if}}>
                      {{localize label}}
                    </option>
                  {{/each}}
                </select>
              </div>
              
              <div class="eventide-item-sheet__effects-grid-cell">
                <select 
                  name="characterEffects.hiddenEffects.{{@index}}.mode"
                  data-index="{{@index}}"
                  data-type="hiddenEffects"
                >
                  <option value="add" {{#if (eq mode "change")}}selected{{/if}}>Add</option>
                  <option value="override" {{#if (eq mode "override")}}selected{{/if}}>Override</option>
                </select>
              </div>
              
              <div class="eventide-item-sheet__effects-grid-cell">
                <div class="base-form__number-input-wrapper">
                  <button type="button" class="decrement" data-action="decrementEffect" data-index="{{@index}}" data-type="hiddenEffects">−</button>
                  <input 
                    type="number" 
                    class="base-form__number-input"
                    name="characterEffects.hiddenEffects.{{@index}}.value" 
                    value="{{value}}" 
                    step="1"
                    data-index="{{@index}}"
                    data-type="hiddenEffects"
                  >
                  <button type="button" class="increment" data-action="incrementEffect" data-index="{{@index}}" data-type="hiddenEffects">+</button>
                </div>
              </div>
              
              <div class="eventide-item-sheet__effects-grid-cell">
                <button 
                  type="button" 
                  class="eventide-item-sheet__effect-remove"
                  data-action="deleteCharacterEffect" 
                  data-index="{{@index}}" 
                  data-type="hiddenEffects"
                  title="Remove hidden effect"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          {{/each}}
        </div>
        
        <div class="eventide-item-sheet__effect-controls">
          <button 
            type="button" 
            class="eventide-item-sheet__add-effect"
            data-action="newCharacterEffect" 
            data-type="hiddenAbilities"
            data-ability="dice"
            title="Add new hidden effect"
          >
            <i class="fas fa-plus"></i> Add Hidden Effect
          </button>
        </div>
      </div>
    {{else if hiddenEffects.length}}
      <div class="eventide-item-sheet__effects-section eventide-item-sheet__effects-section--hidden">
        <h3 class="eventide-item-sheet__effects-section-header">
          Hidden Effects ({{characterEffects.hiddenEffects.length}})
        </h3>
        
        <div class="eventide-item-sheet__effects-grid">
          <div class="eventide-item-sheet__effects-grid-header">
            <div class="eventide-item-sheet__effects-grid-cell">Attribute</div>
            <div class="eventide-item-sheet__effects-grid-cell">Mode</div>
            <div class="eventide-item-sheet__effects-grid-cell">Value</div>
            <div class="eventide-item-sheet__effects-grid-cell">Actions</div>
          </div>
          
          {{#each characterEffects.hiddenEffects}}
            <div class="eventide-item-sheet__effects-grid-row eventide-item-sheet__effects-grid-row--hidden">
              <div class="eventide-item-sheet__effects-grid-cell">
                <select 
                  name="characterEffects.hiddenEffects.{{@index}}.ability"
                  data-index="{{@index}}"
                  data-type="hidden"
                  disabled
                >
                  {{#each ../config.hiddenAbilities as |label key|}}
                    <option value="{{key}}" {{#if (eq ../ability key)}}selected{{/if}}>
                      {{localize label}}
                    </option>
                  {{/each}}
                </select>
              </div>
              
              <div class="eventide-item-sheet__effects-grid-cell">
                <select 
                  name="characterEffects.hiddenEffects.{{@index}}.mode"
                  data-index="{{@index}}"
                  data-type="hidden"
                  disabled
                >
                  <option value="add" {{#if (eq ../mode "change")}}selected{{/if}}>Add</option>
                  <option value="override" {{#if (eq ../mode "override")}}selected{{/if}}>Override</option>
                </select>
              </div>
              
              <div class="eventide-item-sheet__effects-grid-cell">
                <div class="base-form__number-input-wrapper">
                  <button type="button" class="decrement" data-action="decrementEffect" data-index="{{@index}}" data-type="hidden">−</button>
                  <input 
                    type="number" 
                    class="base-form__number-input"
                    name="characterEffects.hiddenEffects.{{@index}}.value" 
                    value="{{value}}" 
                    step="1"
                    data-index="{{@index}}"
                    data-type="hidden"
                    disabled
                  >
                  <button type="button" class="increment" data-action="incrementEffect" data-index="{{@index}}" data-type="hidden">+</button>
                </div>
              </div>
              
              <div class="eventide-item-sheet__effects-grid-cell">
                <i class="fas fa-eye-slash" title="Hidden effect (only visible to GM)"></i>
              </div>
            </div>
          {{/each}}
        </div>
      </div>
    {{/if}}
  </div>
</section>