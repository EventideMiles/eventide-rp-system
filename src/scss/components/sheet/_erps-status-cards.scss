@use "../../utils/themes" as themes;
@use "../../utils/sheet-tokens" as tokens;

// ===================================
// STATUS CARDS COMPONENT
// ===================================
// Reusable status card system for displaying various status indicators
// Extracted from character sheet and modernized following refactoring guidelines

// ===================================
// CONFIGURATION VARIABLES
// ===================================
// Using sheet-tokens where possible, only defining status-specific values

// Spacing and sizing (using sheet-tokens)
$status-card-padding: tokens.$sheet-padding-card;
$status-card-border-radius: tokens.$sheet-radius-md;
$status-card-gap: tokens.$sheet-spacing-md;
$status-card-max-width: tokens.$sheet-width-status-max;
$status-card-icon-size: tokens.$sheet-size-status-element;
$status-card-button-size: tokens.$sheet-size-status-button;

// Typography (using sheet-tokens)
$status-card-label-font-size: tokens.$sheet-font-size-label-xs;
$status-card-details-font-size: tokens.$sheet-font-size-value-sm;
$status-card-icon-font-size: tokens.$sheet-font-size-value-sm;
$status-card-button-icon-size: tokens.$sheet-font-size-label-sm;

// Borders and effects (using sheet-tokens)
$status-card-border-width: tokens.$sheet-border-base;
$status-card-glow-blur: tokens.$sheet-glow-blur-sm;
$status-card-hover-glow-blur: tokens.$sheet-glow-blur-md;

// Transitions and animations (using sheet-tokens)
$status-card-transition-duration: tokens.$sheet-transition-medium;
$status-card-animation-duration-fast: tokens.$sheet-animation-fast;
$status-card-animation-duration-medium: tokens.$sheet-animation-medium;
$status-card-animation-duration-slow: tokens.$sheet-animation-slow;

// Z-index values (using sheet-tokens)
$status-card-z-index-base: tokens.$sheet-z-index-base;
$status-card-z-index-content: tokens.$sheet-z-index-overlay;
$status-card-z-index-dragging: 1000; // Keep high value for dragging

// ===================================
// THEME-AWARE SYSTEM
// ===================================
// Theme-aware system using CSS custom properties that inherit from the main theme

// Default theme variables that inherit from the main theme system
:root {
  --erps-status-primary: var(--theme-primary, rgb(30 58 138 / 90%));
  --erps-status-secondary: var(--theme-secondary, rgb(59 130 246 / 80%));
  --erps-status-bright: var(--theme-light, rgb(59 130 246 / 70%));
  --erps-status-glow: var(--theme-glow, rgb(59 130 246 / 60%));
  --erps-status-text: var(--theme-text, #fff);
  --erps-status-accent: var(--theme-accent, rgb(30 58 138 / 95%));
}

// Theme-aware variants that inherit from the sheet's theme context
.eventide-sheet {
  // Inherit theme colors from the main theme system
  --erps-status-primary: var(--theme-primary);
  --erps-status-secondary: var(--theme-secondary);
  --erps-status-bright: var(--theme-light);
  --erps-status-glow: var(--theme-glow);
  --erps-status-text: var(--theme-text);
  --erps-status-accent: var(--theme-accent);
}

// ===================================
// CONSOLIDATED VARIABLES
// ===================================
// Reduced redundant variables by using tokens and logical grouping

// Status bar container (using sheet-tokens)
$status-bar-margin-top: tokens.$sheet-margin-status-top;
$status-bar-padding: tokens.$sheet-spacing-sm tokens.$sheet-spacing-base;
$status-bar-border-radius: tokens.$sheet-radius-lg;
$status-bar-border-width: tokens.$sheet-border-thin;
$status-bar-arrow-position-offset: tokens.$sheet-status-arrow-offset;
$status-bar-arrow-right-offset: tokens.$sheet-status-arrow-right-offset;
$status-bar-arrow-size: tokens.$sheet-status-arrow-size;
$status-bar-arrow-hover-scale: tokens.$sheet-transform-scale-icon;

// Generic status indicator (using sheet-tokens)
$status-indicator-gap: tokens.$sheet-spacing-xs;
$status-indicator-padding: tokens.$sheet-padding-status-indicator;
$status-indicator-font-size: tokens.$sheet-font-size-label-md;
$status-indicator-icon-font-size: tokens.$sheet-font-size-label-lg;
$status-indicator-border-width: tokens.$sheet-border-thin;
$status-indicator-hover-translate: tokens.$sheet-transform-hover-sm;

// Card transforms and positioning (using sheet-tokens)
$card-hover-translate-y: tokens.$sheet-transform-hover-md;
$card-dragging-rotation: 5deg; // Keep specific value
$card-dragging-opacity: tokens.$sheet-opacity-disabled;
$card-glow-position-offset: -2px; // Keep specific positioning
$card-glow-height-offset: 4px; // Keep specific positioning
$card-glow-width-percentage: tokens.$sheet-glow-width;
$card-glow-left-start: -50%; // Keep specific positioning

// Button styling (using sheet-tokens)
$button-border-radius: tokens.$sheet-radius-sm;
$button-border-width: tokens.$sheet-border-thin;
$button-hover-scale: tokens.$sheet-transform-scale-hover;
$button-active-scale: tokens.$sheet-transform-scale-active;
$button-transition-duration: tokens.$sheet-transition-base;

// Text styling (using sheet-tokens)
$text-letter-spacing: tokens.$sheet-letter-spacing-base;
$text-margin-bottom: tokens.$sheet-spacing-xxs;
$text-line-height: tokens.$sheet-line-height-base;
$text-shadow-blur: tokens.$sheet-shadow-blur-sm;

// Shadow and glow effects (using sheet-tokens)
$shadow-inset-offset: tokens.$sheet-shadow-offset-xs;
$shadow-hover-blur: tokens.$sheet-shadow-blur-sm tokens.$sheet-shadow-blur-md;
$shadow-box-blur: tokens.$sheet-shadow-offset-sm tokens.$sheet-shadow-blur-sm;
$shadow-text-offset: tokens.$sheet-shadow-offset-xs tokens.$sheet-shadow-offset-xs tokens.$sheet-shadow-offset-sm;
$glow-enhanced-blur: tokens.$sheet-glow-blur-lg;

// Animation-specific durations (using sheet-tokens)
$animation-pulse-duration: tokens.$sheet-animation-fast;
$animation-golden-sparkle-duration: tokens.$sheet-animation-medium;
$animation-golden-glow-duration: tokens.$sheet-animation-slow;
$animation-heartbeat-duration: tokens.$sheet-animation-pulse;

// Gradient angles (keep specific values)
$gradient-angle-standard: 135deg;
$gradient-angle-glow: 90deg;

// Opacity values (using sheet-tokens)
$opacity-icon: tokens.$sheet-opacity-default;
$opacity-dragging: tokens.$sheet-opacity-disabled;
$opacity-arrow-hidden: 0;
$opacity-arrow-visible: tokens.$sheet-opacity-full;

// ===================================
// UTILITY MIXINS
// ===================================

// Base status card structure
@mixin status-card-base {
  display: flex;
  align-items: center;
  margin: 0;
  padding: $status-card-padding;
  border-radius: $status-card-border-radius;
  border: $status-card-border-width solid;
  transition: all $status-card-transition-duration ease;
  position: relative;
  overflow: hidden;
  flex: 0 0 auto;
  max-width: $status-card-max-width;
  box-shadow:
    0 0 $status-card-glow-blur,
    inset 0 $shadow-inset-offset 0 themes.color(white, 10);
}

// Animated glow effect
@mixin status-card-glow($color, $animation-name, $duration: $status-card-animation-duration-medium) {
  &::before {
    content: '';
    position: absolute;
    top: $card-glow-position-offset;
    left: $card-glow-left-start;
    width: $card-glow-width-percentage;
    height: calc(100% + #{$card-glow-height-offset});
    background: linear-gradient(
      $gradient-angle-glow,
      transparent,
      themes.color($color, 40),
      transparent
    );
    animation: #{$animation-name} $duration ease-in-out infinite;
    z-index: $status-card-z-index-base;
  }
}

// Status card icon styling
@mixin status-card-icon($color) {
  display: flex;
  align-items: center;
  justify-content: center;
  width: $status-card-icon-size;
  height: $status-card-icon-size;
  border-radius: 50%;
  background: themes.color($color, 40);
  border: $status-card-border-width solid themes.color($color, 70);
  margin-right: $status-card-gap;
  flex-shrink: 0;

  i {
    font-size: $status-card-icon-font-size;
    color: #fff;
    text-shadow: 0 0 $text-shadow-blur themes.color($color, 80);
  }
}

// Status card button styling
@mixin status-card-button($color) {
  display: flex;
  align-items: center;
  justify-content: center;
  width: $status-card-button-size;
  height: $status-card-button-size;
  border-radius: $button-border-radius;
  background: themes.color($color, 30);
  border: $button-border-width solid themes.color($color, 60);
  color: #fff;
  margin-left: $status-card-gap;
  flex-shrink: 0;
  cursor: pointer;
  transition: all $button-transition-duration ease;

  i {
    font-size: $status-card-button-icon-size;
  }

  &:hover {
    background: themes.color($color, 50);
    border-color: themes.color($color, 80);
    transform: scale($button-hover-scale);
    box-shadow: 0 0 $text-shadow-blur themes.color($color, 60);
  }

  &:active {
    transform: scale($button-active-scale);
  }
}

// Status indicator variant mixin
@mixin status-indicator-variant($color) {
  background: themes.color($color, 40);
  border: $status-indicator-border-width solid themes.color($color, 60);
  color: #fff;

  &:hover {
    background: themes.color($color, 50);
  }
}

// Status card variant mixin (consolidates repetitive card patterns)
@mixin status-card-variant($color, $animation-name: null, $animation-duration: $status-card-animation-duration-medium) {
  border-color: themes.color($color, 60);
  background: linear-gradient(
    $gradient-angle-standard,
    themes.color($color, 15) 0%,
    themes.color($color, dark-80) 50%,
    themes.color($color, 10) 100%
  );
  box-shadow:
    0 0 $status-card-glow-blur themes.color($color, 30),
    inset 0 $shadow-inset-offset 0 themes.color(white, 10);

  @if $animation-name {
    @include status-card-glow($color, $animation-name, $animation-duration);
  }

  &:hover {
    transform: translateY($card-hover-translate-y);
    box-shadow:
      0 0 $status-card-hover-glow-blur themes.color($color, 50),
      inset 0 $shadow-inset-offset 0 themes.color(white, 15),
      0 $shadow-hover-blur themes.color(black, 20);
    border-color: themes.color($color, 80);
  }
}

// Common card header structure
@mixin status-card-header {
  display: flex;
  align-items: center;
  width: 100%;
  position: relative;
  z-index: $status-card-z-index-content;
}

// Common card info structure
@mixin status-card-info {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  min-width: 0;
}

// Common card label styling
@mixin status-card-label {
  font-size: $status-card-label-font-size;
  font-weight: 600;
  color: themes.color(white, 90);
  text-transform: uppercase;
  letter-spacing: $text-letter-spacing;
  margin-bottom: $text-margin-bottom;
  line-height: 1;
}

// Common card details styling
@mixin status-card-details($color) {
  font-size: $status-card-details-font-size;
  font-weight: bold;
  color: #fff;
  text-shadow: 0 0 $text-shadow-blur themes.color($color, 60);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: $text-line-height;
}

// ===================================
// STATUS BAR CONTAINER
// ===================================

.eventide-header__status-bar {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: $status-card-gap;
  width: 100%;
  margin-top: $status-bar-margin-top;
  padding: $status-bar-padding;
  background: themes.color(black, 30);
  border-radius: $status-bar-border-radius;
  border: $status-bar-border-width solid themes.color(white, 15);
  box-shadow: inset 0 $shadow-inset-offset 3px themes.color(black, 20);
  position: relative;

  // Horizontal scrolling with hidden scrollbar
  overflow: auto hidden;
  flex-wrap: nowrap;
  scroll-behavior: smooth;
  scrollbar-width: none; // Firefox
  -ms-overflow-style: none; // IE/Edge

  &::-webkit-scrollbar {
    display: none; // Chrome/Safari/Opera
  }

  // Draggable cursor
  cursor: grab;

  &:active {
    cursor: grabbing;
    transform: translateY(0);
  }

  &.dragging {
    opacity: $card-dragging-opacity;
    transform: rotate($card-dragging-rotation);
    z-index: $status-card-z-index-dragging;
  }

  // Directional arrow indicators
  &::before,
  &::after {
    content: '';
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-style: solid;
    opacity: $opacity-arrow-hidden;
    transition: opacity $status-card-transition-duration ease, border-color $button-transition-duration ease, transform $button-transition-duration ease;
    pointer-events: none;
    z-index: 10;
    cursor: pointer;
  }

  // Left arrow
  &::before {
    left: var(--arrow-left-position, $status-bar-arrow-position-offset);
    border-width: $status-bar-arrow-size 0;
    border-color: transparent themes.color(white, 50) transparent transparent;
  }

  // Right arrow
  &::after {
    left: var(--arrow-right-position, calc(100% - #{$status-bar-arrow-right-offset}));
    border-width: $status-bar-arrow-size;
    border-color: transparent transparent transparent themes.color(white, 50);
  }

  // Show arrows when scrollable (classes added via JavaScript)
  &.scrollable-left::before {
    opacity: $opacity-arrow-visible;
    pointer-events: auto;

    &:hover {
      border-color: transparent themes.color(white, 100) transparent transparent;
      transform: translateY(-50%) scale($status-bar-arrow-hover-scale);
    }
  }

  &.scrollable-right::after {
    opacity: $opacity-arrow-visible;
    pointer-events: auto;

    &:hover {
      border-color: transparent transparent transparent themes.color(white, 100);
      transform: translateY(-50%) scale($status-bar-arrow-hover-scale);
    }
  }

  // Hide when empty
  &:empty {
    display: none;
  }
}

// ===================================
// GENERIC STATUS INDICATOR
// ===================================

.eventide-header__status-indicator {
  display: flex;
  align-items: center;
  gap: $status-indicator-gap;
  padding: $status-indicator-padding;
  background: themes.color(white, 10);
  border-radius: $status-card-border-radius;
  font-size: $status-indicator-font-size;
  color: themes.color(white);
  font-weight: 500;
  text-shadow: $shadow-text-offset themes.color(black, 80);
  border: $status-indicator-border-width solid themes.color(white, 10);
  transition: all $button-transition-duration ease;
  flex: 0 0 auto;
  white-space: nowrap;

  i {
    font-size: $status-indicator-icon-font-size;
    opacity: $opacity-icon;
  }

  &:hover {
    background: themes.color(white, 15);
    transform: translateY($status-indicator-hover-translate);
    box-shadow: 0 $shadow-box-blur themes.color(black, 20);
  }

  // Variant states
  &--active {
    @include status-indicator-variant(blue);
  }

  &--warning {
    @include status-indicator-variant(yellow);
  }

  &--danger {
    @include status-indicator-variant(red);
  }
}

// ===================================
// TRANSFORMATION CARD
// ===================================

.eventide-transformation-card {
  @include status-card-base;
  @include status-card-variant(blue);

  // Draggable states
  cursor: grab;
  user-select: none;

  &__header {
    @include status-card-header;
  }

  &__icon {
    @include status-card-icon(blue);
  }

  &__info {
    @include status-card-info;
  }

  &__label {
    @include status-card-label;
  }

  &__name {
    @include status-card-details(blue);
  }

  &__revert {
    @include status-card-button(white);

    &:hover {
      background: themes.color(white, 20);
      border-color: themes.color(white, 50);
      box-shadow: 0 0 $text-shadow-blur themes.color(white, 30);
    }
  }

  &__locked {
    display: flex;
    align-items: center;
    justify-content: center;
    width: $status-card-button-size;
    height: $status-card-button-size;
    border-radius: $button-border-radius;
    background: themes.color(black, 30);
    border: $button-border-width solid themes.color(white, 20);
    color: themes.color(white, 60);
    margin-left: $status-card-gap;
    flex-shrink: 0;
    cursor: not-allowed;

    i {
      font-size: $status-card-button-icon-size;
    }
  }

  // Cursed variant
  &--cursed {
    @include status-card-variant(purple, cursed-transformation-glow, $status-card-animation-duration-fast);

    .eventide-transformation-card__icon {
      @include status-card-icon(purple);
    }

    .eventide-transformation-card__name {
      @include status-card-details(purple);
    }

    .eventide-transformation-card__locked {
      background: themes.color(purple, 30);
      border-color: themes.color(purple, 60);
      color: themes.color(white, 80);
    }
  }
}

// ===================================
// HEALTH STATUS CARD
// ===================================

.eventide-health-card {
  @include status-card-base;
  @include status-card-variant(red);

  &__header {
    @include status-card-header;
  }

  &__icon {
    @include status-card-icon(red);

    i {
      animation: heartbeat $animation-heartbeat-duration ease-in-out infinite;
    }
  }

  &__info {
    @include status-card-info;
  }

  &__label {
    @include status-card-label;
  }

  &__details {
    @include status-card-details(red);
  }

  &__warning {
    @include status-card-button(yellow);

    i {
      animation: pulse $animation-pulse-duration ease-in-out infinite;
    }
  }

  // Critical variant (default)
  &--critical {
    animation: critical-border $status-card-animation-duration-medium ease-in-out infinite;
  }

  // Wounded variant
  &--wounded {
    @include status-card-variant(yellow, wounded-glow, $status-card-animation-duration-slow);

    .eventide-health-card__icon {
      @include status-card-icon(yellow);
    }

    .eventide-health-card__details {
      @include status-card-details(yellow);
    }
  }
}

// ===================================
// EFFECTS STATUS CARD
// ===================================

.eventide-effects-card {
  @include status-card-base;
  @include status-card-variant(yellow, golden-glow, $animation-golden-glow-duration);

  &__header {
    @include status-card-header;
  }

  &__icon {
    @include status-card-icon(yellow);

    i {
      animation: golden-sparkle $animation-golden-sparkle-duration ease-in-out infinite;
    }
  }

  &__info {
    @include status-card-info;
  }

  &__label {
    @include status-card-label;
  }

  &__details {
    @include status-card-details(yellow);
  }

  &__indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    width: $status-card-button-size;
    height: $status-card-button-size;
    border-radius: $button-border-radius;
    background: themes.color(yellow, light-40);
    border: $button-border-width solid themes.color(yellow, light-70);
    color: #fff;
    margin-left: $status-card-gap;
    flex-shrink: 0;

    i {
      font-size: $status-card-button-icon-size;
      animation: golden-twinkle 1.8s ease-in-out infinite;
    }
  }

  // Active variant (default)
  &--active {
    animation: golden-shimmer $status-card-animation-duration-slow ease-in-out infinite;
  }

  // Beneficial variant
  &--beneficial {
    @include status-card-variant(green, beneficial-glow, $status-card-animation-duration-slow);

    .eventide-effects-card__icon {
      @include status-card-icon(green);
    }

    .eventide-effects-card__details {
      @include status-card-details(green);
    }
  }

  // Harmful variant
  &--harmful {
    @include status-card-variant(red, harmful-glow, 2.5s);

    .eventide-effects-card__icon {
      @include status-card-icon(red);
    }

    .eventide-effects-card__details {
      @include status-card-details(red);
    }
  }
}

// ===================================
// CURSED ITEMS CARD
// ===================================

.eventide-cursed-card {
  @include status-card-base;
  @include status-card-variant(purple, ominous-glow, $status-card-animation-duration-slow);

  &__header {
    @include status-card-header;
  }

  &__icon {
    @include status-card-icon(purple);

    i {
      animation: ominous-float $status-card-animation-duration-fast ease-in-out infinite;
    }
  }

  &__info {
    @include status-card-info;
  }

  &__label {
    @include status-card-label;
  }

  &__details {
    @include status-card-details(purple);
  }

  &__warning {
    @include status-card-button(red);

    i {
      animation: ominous-pulse $status-card-animation-duration-medium ease-in-out infinite;
    }
  }

  // Warning variant (default)
  &--warning {
    animation: cursed-shimmer 5s ease-in-out infinite;
  }

  // Deadly variant
  &--deadly {
    @include status-card-variant(red, deadly-glow, $status-card-animation-duration-fast);

    .eventide-cursed-card__icon {
      background: themes.color(red, dark-50);
      border-color: themes.color(red, dark-80);

      i {
        text-shadow: 0 0 8px themes.color(red, dark-90);
      }
    }

    .eventide-cursed-card__details {
      @include status-card-details(red);
    }
  }
}

// ===================================
// ANIMATIONS
// ===================================

@keyframes transformation-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.8;
  }
}

@keyframes cursed-transformation-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.8;
  }
}

@keyframes danger-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.8;
  }
}

@keyframes wounded-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.6;
  }
}

@keyframes golden-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.7;
  }
}

@keyframes beneficial-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.6;
  }
}

@keyframes harmful-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.8;
  }
}

@keyframes ominous-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.6;
  }
}

@keyframes deadly-glow {
  0%, 100% {
    left: -50%;
    opacity: 0;
  }

  50% {
    left: 50%;
    opacity: 0.8;
  }
}

@keyframes heartbeat {
  0%, 100% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.1);
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

@keyframes critical-border {
  0%, 100% {
    border-color: themes.color(red, 60);
  }

  50% {
    border-color: themes.color(red, 90);
  }
}

@keyframes golden-sparkle {
  0%, 100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }

  25% {
    transform: scale(1.1) rotate(90deg);
    opacity: 0.8;
  }

  50% {
    transform: scale(1) rotate(180deg);
    opacity: 1;
  }

  75% {
    transform: scale(1.1) rotate(270deg);
    opacity: 0.8;
  }
}

@keyframes golden-twinkle {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }

  50% {
    opacity: 0.3;
    transform: scale(0.8);
  }
}

@keyframes golden-shimmer {
  0%, 100% {
    box-shadow:
      0 0 $status-card-glow-blur themes.color(yellow, 30),
      inset 0 1px 0 themes.color(white, 10);
  }

  50% {
    box-shadow:
      0 0 $status-card-hover-glow-blur themes.color(yellow, 50),
      inset 0 1px 0 themes.color(white, 20);
  }
}

@keyframes ominous-float {
  0%, 100% {
    transform: translateY(0) scale(1);
  }

  50% {
    transform: translateY(-2px) scale(1.05);
  }
}

@keyframes ominous-pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }

  50% {
    opacity: 0.6;
    transform: scale(0.9);
  }
}

@keyframes cursed-shimmer {
  0%, 100% {
    box-shadow:
      0 0 $status-card-glow-blur themes.color(purple, 30),
      inset 0 1px 0 themes.color(white, 10);
  }

  50% {
    box-shadow:
      0 0 20px themes.color(purple, 50),
      inset 0 1px 0 themes.color(white, 20);
  }
}
