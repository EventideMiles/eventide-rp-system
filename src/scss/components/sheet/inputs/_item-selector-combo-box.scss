@use "config" as *;

// ===================================
// ERPS ITEM SELECTOR COMBO BOX
// ===================================
// Advanced combo box component for selecting items from various sources

.erps-item-selector-combo-box {
  position: relative;
  width: 100%;

  // ===================================
  // INPUT CONTAINER
  // ===================================
  &__input-container {
    position: relative;
    display: flex;
    align-items: center;
  }

  // ===================================
  // INPUT FIELD
  // ===================================
  &__input {
    flex: 1;
    min-width: 0; // Allow flex shrinking
    padding-right: 2.5rem; // Space for dropdown arrow

    // Remove default erps-input right padding when used in combo box
    &.erps-input {
      padding-right: 2.5rem;
    }
  }

  // ===================================
  // DROPDOWN ARROW
  // ===================================
  &__dropdown-arrow {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--erps-current-text, var(--theme-text, var(--erps-default-text)));
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    transition: $input-transition;
    z-index: 2;

    &:hover {
      color: var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
      background: rgb(255 255 255 / 10%);
    }

    &:focus {
      outline: none;
      color: var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
      background: rgb(255 255 255 / 15%);
    }

    i {
      transition: transform $input-transition;
    }
  }

  // ===================================
  // DROPDOWN CONTAINER
  // ===================================
  &__dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 1000;
    background: var(--erps-current-primary, var(--theme-primary, var(--erps-default-primary)));
    border: $input-border-width solid var(--erps-current-secondary, var(--theme-secondary, var(--erps-default-secondary)));
    border-radius: $input-border-radius;
    box-shadow: 0 4px 20px rgb(0 0 0 / 25%),
                0 0 0 2px var(--erps-current-glow, var(--theme-glow, var(--erps-default-glow))) rgb(128 128 128 / 20%);
    max-height: 300px;
    overflow: hidden;
    margin-top: 0.25rem;

    &[aria-hidden="true"] {
      display: none;
    }
  }

  // ===================================
  // LOADING STATE
  // ===================================
  &__loading {
    padding: 1rem;
    text-align: center;
    color: var(--erps-current-text, var(--theme-text, var(--erps-default-text)));

    &-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: $input-font-size;
    }

    i {
      color: var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
    }
  }

  // ===================================
  // EMPTY STATE
  // ===================================
  &__empty {
    padding: 1rem;
    text-align: center;
    color: rgb(var(--erps-current-text, var(--theme-text, var(--erps-default-text))) / 70%);

    &-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-size: $input-font-size;
    }

    i {
      opacity: 0.6;
    }
  }

  // ===================================
  // ITEMS LIST
  // ===================================
  &__list {
    list-style: none;
    margin: 0;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;

    // Custom scrollbar
    &::-webkit-scrollbar {
      width: 8px;
    }

    &::-webkit-scrollbar-track {
      background: var(--erps-current-secondary, var(--theme-secondary, var(--erps-default-secondary)));
    }

    &::-webkit-scrollbar-thumb {
      background: var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
      border-radius: 4px;
    }

    &::-webkit-scrollbar-thumb:hover {
      background: var(--erps-current-glow, var(--theme-glow, var(--erps-default-glow)));
    }
  }

  // ===================================
  // INDIVIDUAL ITEM
  // ===================================
  &__item {
    display: grid;
    grid-template-columns: 60px 1fr auto auto;
    grid-template-areas:
      "icon name type source";
    gap: 0.75rem;
    padding: 0.75rem;
    cursor: pointer;
    border-bottom: 1px solid rgb(var(--erps-current-secondary, var(--theme-secondary, var(--erps-default-secondary))) / 50%);
    transition: $input-transition;
    align-items: center;

    &:last-child {
      border-bottom: none;
    }

    &:hover {
      background: rgb(255 255 255 / 5%);
    }

    &--selected {
      background: rgb(var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright))) / 15%);
      border-left: 3px solid var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
    }

    &:focus {
      outline: none;
      background: rgb(var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright))) / 20%);
    }
  }

  // ===================================
  // ITEM COMPONENTS
  // ===================================
  &__item-icon {
    grid-area: icon;
    display: flex;
    align-items: center;
    justify-content: center;

    img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 0.375rem;
      border: 1px solid rgb(var(--erps-current-secondary, var(--theme-secondary, var(--erps-default-secondary))) / 50%);
      background: var(--erps-current-secondary, var(--theme-secondary, var(--erps-default-secondary)));
    }
  }

  &__item-name {
    grid-area: name;
    font-weight: 600;
    font-size: $input-font-size;
    color: var(--erps-current-text, var(--theme-text, var(--erps-default-text)));
    line-height: 1.4;

    // Ensure text doesn't overflow
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  &__item-type {
    grid-area: type;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
    text-transform: capitalize;
    background: rgb(var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright))) / 20%);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    white-space: nowrap;
  }

  &__item-source {
    grid-area: source;
    font-size: 0.75rem;
    color: rgb(var(--erps-current-text, var(--theme-text, var(--erps-default-text))) / 60%);
    text-align: right;
    line-height: 1.3;

    // Ensure text doesn't overflow
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  // ===================================
  // MORE ITEMS INDICATOR
  // ===================================
  &__more {
    padding: 0.75rem;
    text-align: center;
    border-top: 1px solid rgb(var(--erps-current-secondary, var(--theme-secondary, var(--erps-default-secondary))) / 50%);
    background: rgb(var(--erps-current-secondary, var(--theme-secondary, var(--erps-default-secondary))) / 20%);
    color: rgb(var(--erps-current-text, var(--theme-text, var(--erps-default-text))) / 70%);
    font-size: 0.875rem;
    font-style: italic;

    &-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
  }

  // ===================================
  // OPEN STATE MODIFICATIONS
  // ===================================
  &--open {
    .erps-item-selector-combo-box__dropdown-arrow i {
      transform: rotate(180deg);
    }

    .erps-item-selector-combo-box__input {
      border-color: var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
      box-shadow: 0 0 0 2px var(--erps-current-glow, var(--theme-glow, var(--erps-default-glow)));
    }
  }

  // ===================================
  // RESPONSIVE ADJUSTMENTS
  // ===================================
  @media (max-width: 768px) {
    &__item {
      grid-template-columns: 50px 1fr;
      grid-template-areas:
        "icon name"
        "icon meta";
      gap: 0.5rem;
      padding: 0.5rem;
    }

    &__item-icon img {
      width: 40px;
      height: 40px;
    }

    &__item-type,
    &__item-source {
      grid-area: meta;
      font-size: 0.75rem;
      display: inline-block;
    }

    &__item-type {
      margin-right: 0.5rem;
    }

    &__dropdown {
      max-height: 250px;
    }
  }

  // ===================================
  // ACCESSIBILITY IMPROVEMENTS
  // ===================================
  &__item {
    &:focus-visible {
      outline: 2px solid var(--erps-current-bright, var(--theme-bright, var(--erps-default-bright)));
      outline-offset: -2px;
    }
  }

  // ===================================
  // HIGH CONTRAST MODE SUPPORT
  // ===================================
  @media (prefers-contrast: high) {
    &__dropdown {
      border-width: 2px;
    }

    &__item {
      border-bottom-width: 2px;

      &--selected {
        border-left-width: 4px;
      }
    }

    &__item-icon img {
      border-width: 2px;
    }
  }

  // ===================================
  // REDUCED MOTION SUPPORT
  // ===================================
  @media (prefers-reduced-motion: reduce) {
    &__dropdown-arrow i,
    &__item,
    &__input {
      transition: none;
    }
  }
}