@use "../../utils/themes" as themes;
@use "../../utils/sheet-tokens" as tokens;

// ===================================
// ERPS TOGGLES COMPONENT
// ===================================
// Modern, theme-aware toggle switches for the Eventide RP System
// Uses tertiary theme colors for checked state tracks

// ===================================
// CONFIGURATION VARIABLES
// ===================================
// Using sheet-tokens for consistent design system integration

// Toggle sizing
$toggle-width: 3rem;
$toggle-height: 1.5rem;
$toggle-thumb-size: 1.2rem;
$toggle-border-radius: tokens.$sheet-radius-lg;
$toggle-thumb-border-radius: tokens.$sheet-radius-circle;

// Spacing and positioning
$toggle-thumb-offset: calc(tokens.$sheet-spacing-xs - 3px); // Adjusted 1px left for better visual alignment
$toggle-thumb-travel: calc($toggle-width - $toggle-thumb-size - ($toggle-thumb-offset * 2));
$toggle-border-width: tokens.$sheet-border-base;

// Typography
$toggle-label-font-size: tokens.$sheet-font-size-label-md;
$toggle-label-gap: tokens.$sheet-spacing-sm;
$toggle-font-weight: tokens.$sheet-font-weight-medium;

// Transitions
$toggle-transition-duration: tokens.$sheet-transition-medium;
$toggle-transition-easing: ease-in-out;

// Shadows and effects
$toggle-shadow-blur: tokens.$sheet-shadow-blur-xs;
$toggle-glow-blur: tokens.$sheet-glow-blur-sm;
$toggle-thumb-shadow: 0 tokens.$sheet-shadow-offset-sm tokens.$sheet-shadow-blur-xs;

// Opacity values
$toggle-disabled-opacity: tokens.$sheet-opacity-disabled;
$toggle-focus-opacity: 0.3;

// ===================================
// THEME-AWARE SYSTEM
// ===================================
// Theme-aware system using CSS custom properties that inherit from the main theme

// Default theme variables that inherit from the main theme system
:root {
  --erps-toggle-primary: var(--theme-toggle-track, #2563eb); // Use unique toggle track color with blue fallback
  --erps-toggle-secondary: var(--theme-secondary, #357abd);
  --erps-toggle-bright: var(--theme-light, #6bb6ff);
  --erps-toggle-glow: var(--theme-glow, rgb(74 144 226 / 30%));
  --erps-toggle-text: var(--theme-text, #fff);
}

// Theme-aware variants that inherit from the sheet's theme context
.eventide-sheet {
  // Inherit theme colors from the main theme system
  --erps-toggle-primary: var(--theme-toggle-track); // Use unique toggle track color
  --erps-toggle-secondary: var(--theme-secondary);
  --erps-toggle-bright: var(--theme-light);
  --erps-toggle-glow: var(--theme-glow);
  --erps-toggle-text: var(--theme-text);
}

// ===================================
// UTILITY MIXINS
// ===================================

// Base toggle track styling
@mixin toggle-track-base {
  position: relative;
  display: inline-block;
  width: $toggle-width;
  height: $toggle-height;
  background: themes.color(gray-dark, 60);
  border: $toggle-border-width solid themes.color(gray, 40);
  border-radius: $toggle-border-radius;
  transition: all $toggle-transition-duration $toggle-transition-easing;
  cursor: pointer;
  box-shadow:
    inset 0 1px 3px themes.color(black, 30),
    0 1px 2px themes.color(black, 10);
  flex-shrink: 0;

  &:hover {
    border-color: var(--erps-toggle-bright);
    box-shadow:
      inset 0 1px 3px themes.color(black, 30),
      0 0 $toggle-shadow-blur var(--erps-toggle-glow);
  }
}

// Base toggle thumb styling
@mixin toggle-thumb-base {
  position: absolute;
  top: 50%;
  left: $toggle-thumb-offset;
  width: $toggle-thumb-size;
  height: $toggle-thumb-size;
  background: themes.color(white, 90);
  border: $toggle-border-width solid themes.color(gray, 50);
  border-radius: $toggle-thumb-border-radius;
  transition: all $toggle-transition-duration $toggle-transition-easing;
  cursor: pointer;
  box-shadow: $toggle-thumb-shadow themes.color(black, 30);
  transform: translateY(-50%);

  // Add a subtle inner glow
  &::before {
    content: '';
    position: absolute;
    inset: 2px;
    background: radial-gradient(circle, themes.color(white, 20) 0%, transparent 70%);
    border-radius: $toggle-thumb-border-radius;
    pointer-events: none;
  }
}

// Checked state styling mixin
@mixin toggle-checked-state($primary-color: var(--erps-toggle-primary), $secondary-color: var(--erps-toggle-secondary), $glow-color: var(--erps-toggle-glow)) {
  background: $primary-color;
  border-color: $secondary-color;
  box-shadow:
    inset 0 1px 3px themes.color(black, 20),
    0 0 $toggle-shadow-blur $glow-color;

  .erps-toggles__thumb {
    transform: translateY(-50%) translateX($toggle-thumb-travel);
    background: themes.color(white, 95);
    border-color: $secondary-color;
    box-shadow:
      $toggle-thumb-shadow themes.color(black, 40),
      0 0 $toggle-shadow-blur $glow-color;
  }
}

// Color variant mixin for toggle themes
@mixin toggle-color-variant($color-name) {
  .erps-toggles__input:checked + .erps-toggles__container .erps-toggles__track {
    @include toggle-checked-state(
      themes.color($color-name, 70),
      themes.color($color-name, 80),
      themes.color($color-name, 40)
    );
  }
}

// Size variant mixin
@mixin toggle-size-variant($width, $height, $thumb-size, $label-size) {
  .erps-toggles__track {
    width: $width;
    height: $height;
    border-radius: calc($height / 2);
  }

  .erps-toggles__thumb {
    width: $thumb-size;
    height: $thumb-size;

    --thumb-travel: calc(#{$width} - #{$thumb-size} - (#{$toggle-thumb-offset} * 2));
  }

  .erps-toggles__input:checked + .erps-toggles__container .erps-toggles__track .erps-toggles__thumb {
    transform: translateY(-50%) translateX(var(--thumb-travel));
  }

  .erps-toggles__label {
    font-size: $label-size;
  }
}

// ===================================
// TOGGLE COMPONENT
// ===================================

.erps-toggles {
  // Container for toggle and label
  display: inline-flex;
  align-items: center;
  gap: $toggle-label-gap;
  cursor: pointer;
  user-select: none;
  transition: all $toggle-transition-duration $toggle-transition-easing;

  // Hidden checkbox input
  &__input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
    pointer-events: none;

    &:focus + .erps-toggles__container .erps-toggles__track {
      box-shadow:
        $toggle-thumb-shadow themes.color(black, 30),
        0 0 $toggle-glow-blur var(--erps-toggle-bright);
    }

    &:checked + .erps-toggles__container .erps-toggles__track {
      @include toggle-checked-state;
    }

    &:disabled + .erps-toggles__container .erps-toggles__track {
      opacity: $toggle-disabled-opacity;
      cursor: not-allowed;
      background: themes.color(gray, 30);
      border-color: themes.color(gray, 40);

      .erps-toggles__thumb {
        background: themes.color(gray, 60);
        border-color: themes.color(gray, 70);
        box-shadow: $toggle-thumb-shadow themes.color(black, 20);
      }
    }
  }

  // Container wrapper for track and label positioning
  &__container {
    display: flex;
    align-items: center;
    gap: $toggle-label-gap;
  }

  // Track (background of the toggle)
  &__track {
    @include toggle-track-base;
  }

  // Thumb (the sliding button part)
  &__thumb {
    @include toggle-thumb-base;
  }

  // Label text
  &__label {
    font-family: var(--erps-ui-font, sans-serif);
    font-size: $toggle-label-font-size;
    font-weight: $toggle-font-weight;
    color: var(--erps-toggle-text);
    cursor: pointer;
    transition: color $toggle-transition-duration $toggle-transition-easing;
    text-shadow: 0 1px 2px themes.color(black, 60);
  }

  // ===================================
  // MODIFIER CLASSES
  // ===================================

  // Size modifiers
  &--small {
    @include toggle-size-variant(2.5rem, 1.25rem, 1rem, tokens.$sheet-font-size-label-sm);
  }

  &--large {
    @include toggle-size-variant(3.5rem, 1.75rem, 1.4rem, tokens.$sheet-font-size-value-md);
  }

  // Label position modifiers - BEM styled
  &--label-left {
    .erps-toggles__container {
      .erps-toggles__label {
        order: 1; // Label first (left)
      }

      .erps-toggles__track {
        order: 2; // Track second (right)
      }
    }
  }

  &--label-right {
    .erps-toggles__container {
      .erps-toggles__track {
        order: 1; // Track first (left)
      }

      .erps-toggles__label {
        order: 2; // Label second (right)
      }
    }
  }

  &--label-above {
    .erps-toggles__container {
      flex-direction: column;
      align-items: flex-start;
      gap: tokens.$sheet-spacing-xs;

      .erps-toggles__label {
        order: 1; // Label first (above)
      }

      .erps-toggles__track {
        order: 2; // Track second (below)
      }
    }
  }

  &--label-below {
    .erps-toggles__container {
      flex-direction: column;
      align-items: flex-start;
      gap: tokens.$sheet-spacing-xs;

      .erps-toggles__track {
        order: 1; // Track first (above)
      }

      .erps-toggles__label {
        order: 2; // Label second (below)
      }
    }
  }

  // No label (toggle only)
  &--no-label {
    .erps-toggles__label {
      display: none;
    }
  }

  // State modifiers
  &--disabled {
    opacity: $toggle-disabled-opacity;
    cursor: not-allowed;
    pointer-events: none;
  }

  // Color theme overrides (for specific use cases)
  &--success {
    @include toggle-color-variant(green);
  }

  &--danger {
    @include toggle-color-variant(red);
  }

  &--warning {
    @include toggle-color-variant(orange);
  }

  // Restore target variant - label left, toggle right, with background
  &--restore-row {
    display: block;
    width: 100%;
    padding: tokens.$sheet-spacing-sm tokens.$sheet-spacing-md;
    margin-bottom: tokens.$sheet-spacing-xs;
    background: rgb(0 0 0 / 8%);
    border: 1px solid var(--theme-secondary, var(--erps-sheet-secondary));
    border-radius: tokens.$sheet-radius-sm;
    transition: all tokens.$sheet-transition-fast ease;

    &:hover {
      background: rgb(255 255 255 / 5%);
      border-color: var(--theme-light, var(--erps-sheet-light));
    }

    .erps-toggles__container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;

      .erps-toggles__label {
        order: 1; // Label first (left)
        flex: 1;
        text-align: left;
      }

      .erps-toggles__track {
        order: 2; // Track second (right)
        flex-shrink: 0;
      }
    }
  }
}

// ===================================
// USAGE EXAMPLES (HTML)
// ===================================

/*
<!-- Basic toggle with label on left (default) -->
<label class="erps-toggles">
  <input type="checkbox" class="erps-toggles__input">
  <div class="erps-toggles__container">
    <span class="erps-toggles__label">Enable Feature</span>
    <span class="erps-toggles__track">
      <span class="erps-toggles__thumb"></span>
    </span>
  </div>
</label>

<!-- Small toggle without label -->
<label class="erps-toggles erps-toggles--small erps-toggles--no-label">
  <input type="checkbox" class="erps-toggles__input">
  <div class="erps-toggles__container">
    <span class="erps-toggles__track">
      <span class="erps-toggles__thumb"></span>
    </span>
  </div>
</label>

<!-- Toggle with label on right -->
<label class="erps-toggles erps-toggles--label-right">
  <input type="checkbox" class="erps-toggles__input">
  <div class="erps-toggles__container">
    <span class="erps-toggles__label">Auto-save</span>
    <span class="erps-toggles__track">
      <span class="erps-toggles__thumb"></span>
    </span>
  </div>
</label>

<!-- Toggle with label above -->
<label class="erps-toggles erps-toggles--label-above">
  <input type="checkbox" class="erps-toggles__input">
  <div class="erps-toggles__container">
    <span class="erps-toggles__label">Setting Name</span>
    <span class="erps-toggles__track">
      <span class="erps-toggles__thumb"></span>
    </span>
  </div>
</label>

<!-- Toggle with label below -->
<label class="erps-toggles erps-toggles--label-below">
  <input type="checkbox" class="erps-toggles__input">
  <div class="erps-toggles__container">
    <span class="erps-toggles__label">Option</span>
    <span class="erps-toggles__track">
      <span class="erps-toggles__thumb"></span>
    </span>
  </div>
</label>

<!-- Success-themed toggle -->
<label class="erps-toggles erps-toggles--success">
  <input type="checkbox" class="erps-toggles__input" checked>
  <div class="erps-toggles__container">
    <span class="erps-toggles__label">Task Complete</span>
    <span class="erps-toggles__track">
      <span class="erps-toggles__thumb"></span>
    </span>
  </div>
</label>
*/
