@use "../../utils/themes" as themes;
@use "../../utils/tokens" as tokens;
@use "../../utils/colors" as colors;
@use "../../utils/sheet-tokens" as sheet;

// ===================================
// RESOURCE BOXES COMPONENT
// ===================================
// Reusable resource display system with structured upper/lower sections
// Extracted from character sheet and modernized following refactoring guidelines

// ===================================
// UTILITY MIXINS
// ===================================

// Base resource container styling
@mixin resource-container-base {
  position: relative;
  overflow: hidden;
  transition: all sheet.$sheet-transition-medium ease;
  display: flex;
  flex-direction: column;
  border-radius: sheet.$sheet-radius-xl;
  border: sheet.$sheet-border-base solid;
}

// Resource section styling
@mixin resource-section-base {
  display: flex;
  align-items: center;
  justify-content: center;
  width: sheet.$sheet-percent-full;
  position: relative;
}

// Upper section (label) styling
@mixin resource-upper-section {
  @include resource-section-base;

  height: sheet.$sheet-height-section-upper;
  padding: 0; // No padding to allow full width labels

  // Label styling within upper section
  .erps-resource-box__label,
  .erps-stat-box__label {
    width: sheet.$sheet-percent-full;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 0 sheet.$sheet-spacing-xs; // Minimal padding only to prevent edge touching
  }
}

// Lower section (inputs/data) styling
@mixin resource-lower-section {
  @include resource-section-base;

  height: sheet.$sheet-height-section-lower;
  padding: 0 sheet.$sheet-spacing-sm; // Minimal side padding
  gap: sheet.$sheet-spacing-xs;

  // Ensure inputs/content fit properly
  .erps-resource-box__input,
  .erps-stat-box__value,
  .resource-content {
    flex: 1;
    min-width: sheet.$sheet-width-input-min;
  }

  // Special handling for single input (fill space)
  &:has(.erps-resource-box__input:only-child) .erps-resource-box__input,
  &:has(.erps-stat-box__value:only-child) .erps-stat-box__value {
    flex: 1;
    max-width: sheet.$sheet-percent-full;
  }
}

// Optional third section (resource labels)
@mixin resource-third-section {
  @include resource-section-base;

  height: sheet.$sheet-height-section-third;
  padding: 0 sheet.$sheet-spacing-xs;
  font-size: sheet.$sheet-font-size-label-xs;
  color: themes.color(white, 70);

  &:empty {
    // Still take up space for alignment even when empty
    visibility: hidden;
  }
}

// Animated glow effect for resource boxes
@mixin resource-glow-animation($color: themes.color(blue, 20)) {
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: (- sheet.$sheet-percent-full);
    width: sheet.$sheet-percent-full;
    height: sheet.$sheet-percent-full;
    background: linear-gradient(
      90deg,
      transparent,
      $color,
      transparent
    );
    transition: left sheet.$sheet-transition-slow ease;
    z-index: 1;
  }

  &:hover::before {
    left: sheet.$sheet-percent-full;
  }

  // Ensure content is above the glow effect
  > * {
    position: relative;
    z-index: 2;
  }
}

// Resource text styling mixin
@mixin resource-text-base($font-family: var(--erps-info-font)) {
  font-family: $font-family !important;
  font-weight: sheet.$sheet-font-weight-semibold !important;
  text-transform: uppercase !important;
  text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-shadow-offset-sm themes.color(black, 80) !important;
}

// Resource value styling mixin
@mixin resource-value-base($font-family: var(--erps-mono-font)) {
  font-family: $font-family !important;
  font-weight: sheet.$sheet-font-weight-bold !important;
  color: #fff !important;
  text-shadow:
    0 sheet.$sheet-shadow-offset-sm sheet.$sheet-shadow-offset-md themes.color(black, 80),
    0 0 sheet.$sheet-glow-blur-md themes.color(blue, 60) !important;
}

// ===================================
// GENERAL RESOURCE SELECTORS
// ===================================
// These are global selectors that can be used anywhere for basic resource styling

.resource-label {
  @include resource-text-base;

  color: colors.$universal-white;
  font-size: sheet.$sheet-font-size-label-md;
}

.resource-value {
  @include resource-value-base;

  display: inline-block;
  padding: tokens.$spacing-sm;
  background: themes.color(black, 40) !important;
  border: sheet.$sheet-border-thin solid themes.color(white, 15) !important;
  border-radius: tokens.$radius-sm;
  color: colors.$universal-white !important;
  font-weight: 500;
  text-align: center;
  min-width: sheet.$sheet-width-input-min;
  font-family: monospace;
  font-size: sheet.$sheet-font-size-value-md;
  opacity: sheet.$sheet-opacity-default;
  cursor: default;
  user-select: none;
  box-shadow: inset 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-radius-xs themes.color(black, 30);

  &:hover {
    opacity: sheet.$sheet-opacity-full;
    background: themes.color(black, 50) !important;
  }
}

// ===================================
// ENHANCED RESOURCE BOX COMPONENT
// ===================================

.erps-resource-box {
  @include resource-container-base;

  // Move all direct declarations before nested rules and includes with nested content
  background: linear-gradient(
    135deg,
    themes.color(blue-dark, 90) 0%,
    themes.color(blue-dark, 80) 100%
  );
  border-color: themes.color(blue, 50);
  box-shadow:
    0 sheet.$sheet-shadow-blur-xs sheet.$sheet-shadow-blur-xxl themes.color(black, 30),
    inset 0 sheet.$sheet-shadow-offset-xs 0 themes.color(white, 10);

  // Include glow animation last since it contains nested rules
  @include resource-glow-animation(themes.color(blue, 20));

  // Upper section - always contains the main label
  &__upper {
    @include resource-upper-section;
  }

  // Lower section - contains inputs or data
  &__lower {
    @include resource-lower-section;
  }

  // Optional third section - for resource labels (can be above or below lower)
  &__third {
    @include resource-third-section;
  }

  // Label styling
  &__label {
    @include resource-text-base;

    font-size: sheet.$sheet-font-size-label-md !important;
    color: themes.color(white, 90) !important;
    letter-spacing: sheet.$sheet-letter-spacing-loose !important;
    line-height: 1.2 !important;
  }

  // Input styling
  &__input {
    font-family: var(--erps-mono-font) !important;
    font-size: sheet.$sheet-font-size-value-md !important;
    font-weight: 600 !important;
    color: #fff !important;
    background: themes.color(blue-dark, 80) !important;
    border: 1px solid themes.color(blue, 40) !important;
    border-radius: sheet.$sheet-radius-sm !important;
    padding: sheet.$sheet-padding-input !important;
    text-align: center !important;
    text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-shadow-offset-sm themes.color(black, 80) !important;
    transition: all sheet.$sheet-transition-base ease !important;

    &:focus {
      border-color: themes.color(blue, 80) !important;
      box-shadow:
        0 0 0 2px themes.color(blue, 30),
        0 0 sheet.$sheet-glow-blur-md themes.color(blue, 40) !important;
      outline: none !important;
    }
  }

  // Separator styling (like "/")
  &__separator {
    font-family: var(--erps-mono-font) !important;
    font-size: sheet.$sheet-font-size-label-lg !important;
    color: themes.color(white, 80) !important;
    text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-shadow-offset-sm themes.color(black, 80) !important;
    flex-shrink: 0;
  }

  // Value display styling
  &__value {
    @include resource-value-base;

    font-size: sheet.$sheet-font-size-value-xl !important;
    text-align: center;
  }

  // Color variants
  &--health {
    background: linear-gradient(
      135deg,
      themes.color(red-dark, 90) 0%,
      themes.color(red-dark, 80) 100%
    );
    border-color: themes.color(red, 50);

    @include resource-glow-animation(themes.color(red, 20));

    .erps-resource-box__value {
      text-shadow:
        0 sheet.$sheet-shadow-offset-sm sheet.$sheet-shadow-offset-md themes.color(black, 80),
        0 0 sheet.$sheet-glow-blur-md themes.color(red, 60) !important;
    }

    .erps-resource-box__input {
      background: themes.color(red-dark, 80) !important;
      border-color: themes.color(red, 40) !important;

      &:focus {
        border-color: themes.color(red, 80) !important;
        box-shadow:
          0 0 0 2px themes.color(red, 30),
          0 0 sheet.$sheet-glow-blur-md themes.color(red, 40) !important;
      }
    }
  }

  &--mana {
    background: linear-gradient(
      135deg,
      themes.color(purple-dark, 90) 0%,
      themes.color(purple-dark, 80) 100%
    );
    border-color: themes.color(purple, 50);

    @include resource-glow-animation(themes.color(purple, 20));

    .erps-resource-box__value {
      text-shadow:
        0 sheet.$sheet-shadow-offset-sm sheet.$sheet-shadow-offset-md themes.color(black, 80),
        0 0 sheet.$sheet-glow-blur-md themes.color(purple, 60) !important;
    }

    .erps-resource-box__input {
      background: themes.color(purple-dark, 80) !important;
      border-color: themes.color(purple, 40) !important;

      &:focus {
        border-color: themes.color(purple, 80) !important;
        box-shadow:
          0 0 0 2px themes.color(purple, 30),
          0 0 sheet.$sheet-glow-blur-md themes.color(purple, 40) !important;
      }
    }
  }

  &--neutral {
    background: linear-gradient(
      135deg,
      themes.color(gray-dark, 90) 0%,
      themes.color(gray-dark, 80) 100%
    );
    border-color: themes.color(gray, 30);

    @include resource-glow-animation(themes.color(gray, 10));

    .erps-resource-box__value {
      text-shadow:
        0 sheet.$sheet-shadow-offset-sm sheet.$sheet-shadow-offset-md themes.color(black, 80),
        0 0 sheet.$sheet-glow-blur-md themes.color(gray, 50) !important;
    }

    .erps-resource-box__input {
      background: themes.color(black, 40) !important;
      border-color: themes.color(gray, 20) !important;

      &:focus {
        border-color: themes.color(gray, 50) !important;
        box-shadow:
          0 0 0 2px themes.color(gray, 20),
          0 0 sheet.$sheet-glow-blur-md themes.color(gray, 30) !important;
      }
    }
  }
}

// ===================================
// SECONDARY STAT BOX COMPONENT
// ===================================

.erps-stat-box {
  @include resource-container-base;

  background: linear-gradient(
    135deg,
    themes.color(blue-dark, 70) 0%,
    themes.color(blue-dark, 60) 100%
  );
  border-color: themes.color(blue, 40);
  box-shadow:
    0 sheet.$sheet-shadow-offset-sm sheet.$sheet-shadow-blur-md themes.color(black, 20),
    inset 0 sheet.$sheet-shadow-offset-xs 0 themes.color(white, 5);

  // Upper section - always contains the main label
  &__upper {
    @include resource-upper-section;
  }

  // Lower section - contains values or data
  &__lower {
    @include resource-lower-section;
  }

  // Optional third section - for resource labels
  &__third {
    @include resource-third-section;
  }

  // Label styling
  &__label {
    @include resource-text-base;

    font-size: sheet.$sheet-font-size-label-sm !important;
    color: themes.color(white, 80) !important;
    letter-spacing: sheet.$sheet-letter-spacing-base !important;
    line-height: sheet.$sheet-line-height-base !important;
  }

  // Value styling
  &__value {
    @include resource-value-base;

    font-size: sheet.$sheet-font-size-value-lg !important;
    text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-radius-xs themes.color(black, 80),
      0 0 sheet.$sheet-glow-blur-sm themes.color(blue, 50) !important;
    text-align: center;
  }

  // Separator styling (like "-")
  &__separator {
    font-family: var(--erps-mono-font) !important;
    font-size: sheet.$sheet-font-size-value-lg !important;
    color: themes.color(white, 80) !important;
    text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-shadow-offset-sm themes.color(black, 80) !important;
    flex-shrink: 0;
  }

  // Color variants for stat boxes
  &--health {
    background: linear-gradient(
      135deg,
      themes.color(red-dark, 70) 0%,
      themes.color(red-dark, 60) 100%
    );
    border-color: themes.color(red, 40);

    .erps-stat-box__value {
      text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-radius-xs themes.color(black, 80),
        0 0 sheet.$sheet-glow-blur-sm themes.color(red, 50) !important;
    }
  }

  &--mana {
    background: linear-gradient(
      135deg,
      themes.color(purple-dark, 70) 0%,
      themes.color(purple-dark, 60) 100%
    );
    border-color: themes.color(purple, 40);

    .erps-stat-box__value {
      text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-radius-xs themes.color(black, 80),
        0 0 sheet.$sheet-glow-blur-sm themes.color(purple, 50) !important;
    }
  }

  &--neutral {
    background: linear-gradient(
      135deg,
      themes.color(gray-dark, 70) 0%,
      themes.color(gray-dark, 60) 100%
    );
    border-color: themes.color(gray, 20);

    .erps-stat-box__value {
      text-shadow: 0 sheet.$sheet-shadow-offset-xs sheet.$sheet-radius-xs themes.color(black, 80),
        0 0 sheet.$sheet-glow-blur-sm themes.color(gray, 30) !important;
    }
  }
}

// ===================================
// GRID CONTAINER STYLING
// ===================================
// Ensure resource boxes in the same grid row have equal heights and section alignment

.resources.grid {
  display: grid;
  gap: sheet.$sheet-spacing-base;
  align-items: stretch; // Force all grid items to stretch to the same height

  &.grid-3col {
    grid-template-columns: repeat(3, 1fr);
  }

  &.grid-4col {
    grid-template-columns: repeat(4, 1fr);
  }

  // Ensure all resource boxes stretch to fill their grid cell
  .erps-resource-box,
  .erps-stat-box {
    height: sheet.$sheet-percent-full; // Fill the grid cell height

    // Calculate section heights based on whether third section exists
    &:not(:has(.erps-resource-box__third, .erps-stat-box__third)) {
      // Two-section layout: upper + lower
      .erps-resource-box__upper,
      .erps-stat-box__upper {
        flex: 0 0 sheet.$sheet-height-section-upper;
      }

      .erps-resource-box__lower,
      .erps-stat-box__lower {
        flex: 1; // Take remaining space
      }
    }

    &:has(.erps-resource-box__third, .erps-stat-box__third) {
      // Three-section layout: distribute space
      .erps-resource-box__upper,
      .erps-stat-box__upper {
        flex: 0 0 sheet.$sheet-height-section-upper;
      }

      .erps-resource-box__third,
      .erps-stat-box__third {
        flex: 0 0 sheet.$sheet-height-section-third;
      }

      .erps-resource-box__lower,
      .erps-stat-box__lower {
        flex: 1; // Take remaining space
      }
    }
  }

  // If any box in the row has a third section, all should reserve space for it
  &:has(.erps-resource-box__third, .erps-stat-box__third) {
    .erps-resource-box:not(:has(.erps-resource-box__third)),
    .erps-stat-box:not(:has(.erps-stat-box__third)) {
      // Add invisible third section for alignment
      &::after {
        content: '';
        height: sheet.$sheet-height-section-third;
        flex: 0 0 sheet.$sheet-height-section-third;
      }
    }
  }
}
