@use "../utils/typography";
@use "../utils/colors";
@use "../utils/variables";

// This is depreciated and kept around for the time being until I've ensured that the new system
// suits my user base.

// Section Header
.effects-header {
  height: 28px;
  margin: 2px 0;
  padding: 0;
  align-items: center;
  background: rgb(0 0 0 / 5%);
  border: variables.$border-groove;
  font-weight: bold;

  >* {
    font-size: 14px;
    text-align: center;
  }

  .effect-name {
    font-weight: bold;
    padding-left: 5px;
    text-align: left;
    display: flex;

    // font-size: 16px;
  }
}

// -----------------------------------------
// Items Lists
// -----------------------------------------

.effects-list {
  list-style: none;
  margin: 0;
  padding: 0;
  overflow-y: auto;
  color: colors.$c-tan;

  // Child lists
  .effect-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  // Item Name
  .effect-name {
    flex: 2;
    margin: 0;
    overflow: hidden;
    font-size: 13px;
    text-align: left;
    align-items: center;
    display: flex;

    h3,
    h4 {
      margin: 0;
      white-space: nowrap;
      overflow-x: hidden;
    }
  }

  // Control Buttons
  .effect-controls {
    display: flex;
    flex: 0 0 100px;
    justify-content: flex-end;

    a {
      font-size: 12px;
      text-align: center;
      margin: 0 6px;
    }
  }

  // Individual Item
  .effect {
    align-items: center;
    padding: 0 2px; // to align with the header border
    border-bottom: 1px solid colors.$c-faint;

    &:last-child {
      border-bottom: none;
    }

    .effect-name {
      color: colors.$c-dark;

      .effect-image {
        flex: 0 0 30px;
        height: 30px;
        background-size: 30px;
        border: none;
        margin-right: 5px;
      }
    }
  }

  .effect-prop {
    text-align: center;
    border-left: 1px solid #c9c7b8;
    border-right: 1px solid #c9c7b8;
    font-size: 12px;
  }

  // Section Header
  .effects-header {
    height: 28px;
    margin: 2px 0;
    padding: 0;
    align-items: center;
    background: rgb(0 0 0 / 5%);
    border: variables.$border-groove;
    font-weight: bold;

    >* {
      font-size: 12px;
      text-align: center;
    }

    .effect-name {
      padding-left: 5px;
      text-align: left;

      // font-size: 16px;
    }
  }
}

// Example style for EventideRpSystem (can be removed if not needed).
.effect-formula {
  flex: 0 0 200px;
  padding: 0 8px;
}

.effects .item {
  .effect-source,
  .effect-duration,
  .effect-controls {
    text-align: center;
    border-left: 1px solid #c9c7b8;
    border-right: 1px solid #c9c7b8;
    font-size: 12px;
  }

  .effect-controls {
    border: none;
  }
}

// Character Effects Styling for Item Sheet
.eventide-item-sheet {
  // Effects container
  &__effects-container {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 0.5rem;
    overflow-y: auto;
  }
  
  // Effects header
  &__effects-header {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    background-color: rgb(0 0 0 / 5%);
    border: 1px solid #dbd9c9;
    border-radius: 3px;
  }
  
  // Effects grid
  &__effects-grid {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    
    &-header {
      display: grid;
      grid-template-columns: 1.5fr 1.5fr 1fr 0.5fr;
      gap: 0.5rem;
      padding: 0.5rem 0;
      font-weight: bold;
      border-bottom: 1px solid #dbd9c9;
    }
    
    &-row {
      display: grid;
      grid-template-columns: 1.5fr 1.5fr 1fr 0.5fr;
      gap: 0.5rem;
      padding: 0.25rem 0;
      border-bottom: 1px solid rgb(0 0 0 / 5%);
      
      &--hidden {
        background-color: rgb(0 0 0 / 3%);
      }
      
      &:last-child {
        border-bottom: none;
      }
    }
    
    &-cell {
      display: flex;
      align-items: center;
      
      select {
        display: block;
        width: 100%;
        height: 2.5rem;
        padding: 0.5rem;
        color: colors.$input-text;
        background-color: colors.$input-bg !important;
        border: none;
        box-shadow: 
          0 0 0 1px rgb(0 0 0 / 80%),
          inset 0 1px 3px rgb(0 0 0 / 60%);
        border-radius: 5px;
        appearance: none;
      }
      
      // Keep base styling for standard inputs
      input:not(.base-form__number-input) {
        display: block;
        width: 100%;
        height: 2.5rem;
        padding: 0.5rem;
        color: colors.$input-text;
        background-color: colors.$input-bg !important;
        border: none;
        box-shadow: 
          0 0 0 1px rgb(0 0 0 / 80%),
          inset 0 1px 3px rgb(0 0 0 / 60%);
        border-radius: 5px;
        appearance: none;
      }
      
      // Style for number input wrapper
      .base-form__number-input-wrapper {
        width: 100%;
        
        // Ensure buttons are visible by default
        .increment, .decrement {
          display: flex;
        }
      }
      
      button {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: colors.$input-bg !important;
        color: colors.$button-text !important;
        border: 1px solid colors.$button-border !important;
        border-radius: 5px !important;
        cursor: pointer !important;
        transition: all 0.2s ease-in-out !important;
        box-shadow: 0 0 0 0 transparent !important;
        
        &:hover {
          background-color: colors.$button-hover !important;
          color: #f44 !important;
        }
      }
    }
  }
  
  // Effects section
  &__effects-section {
    margin-bottom: 1rem;
    
    &--hidden {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 2px dashed #dbd9c9;
    }
    
    &-header {
      font-size: 1rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      padding-bottom: 0.25rem;
      border-bottom: 1px solid #dbd9c9;
      color: colors.$c-tan;
    }
  }
  
  // Scrollable container
  &__scrollable-container {
    flex: 1;
    overflow-y: auto;
    max-height: 20rem;
    margin-top: 0.5rem;
    padding-right: 0.5rem; // Add some padding for the scrollbar
  }
  
  // Effect toggle
  &__effect-toggle {
    width: fit-content;

    // width: max-content;
    margin: 0 auto;
    margin-top: 0.5rem;
    display: inline-block;
    padding: 0.75rem;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    cursor: pointer;
    white-space: nowrap;
    background-color: #373737;
    color: #fff;
    border-radius: 10px;
    border: 1px inset colors.$c-dark;
    
    &--global {
      font-weight: bold;
      font-size: 0.9rem;
      background-color: colors.$c-faint;
      border-color: colors.$c-dark;
      
      &:hover {
        background-color: colors.$c-faint;
      }
    }

    &--active {
      background-color: colors.$effect;
      border-color: #7a4823; 
      color: colors.$c-black;
      border: 1px outset colors.$c-dark;
    }
    
    // &:hover {
    //   background-color: colors.$c-faint;
    // }
    
    input[type="checkbox"] {
      margin: 0;
      width: 16px;
      height: 16px;
      display: none;
      
      &:checked + .eventide-item-sheet__effect-toggle-label {
        font-weight: bold;

        // color: #ffffff;
        // background-color: #007bff;
      }
    }
    
    &-label {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
  
  // Effect controls
  &__effect-controls {
    display: flex;
    justify-content: flex-start;
    margin-top: 0.5rem;
    gap: 0.5rem;
  }
  
  // Effect buttons
  &__effect-remove {
    background: none;
    border: none;
    color: #dc3545;
    cursor: pointer;
    padding: 0.25rem;
    transition: transform 0.2s ease-in-out;
    display: flex;
    align-items: center;
    justify-content: center;
    
    &:hover {
      transform: scale(1.1);
    }
  }
  
  &__add-effect {
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 3px;
    padding: 0.25rem 0.5rem;
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
    font-size: 0.9rem;
    
    &:hover {
      background: #0056b3;
    }
  }
  
  // Hidden effects
  &__hidden-effects {
    margin-top: 1rem;
    border: 1px solid #dbd9c9;
    border-radius: 3px;
    padding: 0.5rem;
    background-color: rgb(0 0 0 / 2%);
    
    &-header {
      font-weight: bold;
      color: colors.$c-dark;
      cursor: pointer;
      display: flex;
      align-items: center;
      
      &:hover {
        color: colors.$c-tan;
      }
      
      &::before {
        content: 'â–¼';
        margin-right: 0.5rem;
        font-size: 0.8rem;
      }
    }
  }
  
  // No effects message
  &__no-effects {
    font-style: italic;
    color: colors.$c-tan;
    text-align: center;
    padding: 1rem;
  }
  
  // Effect inputs
  &__effect-attribute,
  &__effect-mode,
  &__effect-value {
    padding: 0.25rem;
    border: 1px solid #dbd9c9;
    border-radius: 3px;
    background: #fff;
    
    &:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 5px rgb(0 0 0 / 10%);
    }
  }
  
  // Foundry V12 compatibility adjustments
  .tab.effects {
    padding: 0.5rem;
    
    h3 {
      border-bottom: 1px solid #dbd9c9;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }
  }
}

// Prerequisites tab styling
.tab[data-tab="prerequisites"] {
  textarea {
    width: 100%;
    min-height: 6rem;
    resize: vertical;
    color: colors.$input-text;
    background-color: colors.$input-bg !important;
    border: none;
    box-shadow: 
      0 0 0 1px rgb(0 0 0 / 80%),
      inset 0 1px 3px rgb(0 0 0 / 60%);
    border-radius: 5px;
    padding: 0.5rem;
    
    &:focus {
      outline: none;
      border-color: colors.$input-focus;
      box-shadow: 
        0 0 0 1px rgb(255 255 255 / 10%),
        inset 0 1px 3px rgb(0 0 0 / 70%);
    }
  }
}

// Responsive adjustments for smaller screens
@media (width <= 768px) {
  .eventide-item-sheet {
    &__effects-grid {
      &-header, &-row {
        grid-template-columns: 1fr 1fr 0.8fr 0.4fr;
      }
    }
    
    &__effect-toggle {
      font-size: 0.8rem;
      
      &--global {
        font-size: 0.85rem;
      }
    }
  }
}

// Add scrollbar styling for item sheet
.eventide-item-sheet--scrollbars {
  // Apply scrollbars to the tab content
  .tab.effects, .tab.characterEffects {
    height: auto;
    overflow-y: auto !important;
  }
}