@use "../utils/themes" as themes;
@use "../utils/colors" as colors;
@use "../utils/typography" as typography;
@use "../utils/mixins" as mixins;
@use "../utils/tokens" as tokens;
@use "sass:math";
@use "sass:list";

// ===================================
// ERPS TABS COMPONENT
// ===================================
// Modern, reusable tab system component following BEM methodology
// Integrates with the Eventide RP System theme system
// Supports both standard Foundry tabs and custom gear tabs

// ===================================
// CONFIGURATION VARIABLES
// ===================================

// Spacing and sizing
$erps-tab-border-radius: 6px;
$erps-tab-border-radius-large: 8px;
$erps-tab-padding: 0.5rem 1rem;
$erps-tab-padding-large: 0.75rem 1.5rem;
$erps-tab-padding-container: 0.25rem 0.25rem 0;
$erps-tab-margin-right: 0.25rem;
$erps-tab-gap: 0.5rem;
$erps-tab-nav-padding-bottom: 0.5rem;
$erps-tab-nav-margin-bottom: 1rem;

// Heights
$erps-tab-height-standard: auto;
$erps-tab-height-large: 3.5rem;
$erps-tab-content-height-scrollable: 39.06rem;

// Typography
$erps-tab-font-size: 12pt;
$erps-tab-font-size-large: 14pt;
$erps-tab-font-weight: 600;
$erps-tab-letter-spacing: 0.5px;

// Borders and effects
$erps-tab-border-width: 1px;
$erps-tab-border-width-thick: 2px;
$erps-tab-border-width-accent: 4px;
$erps-tab-shadow-blur: 12px;
$erps-tab-shadow-blur-large: 20px;
$erps-tab-shadow-blur-small: 8px;

// Transitions and animations
$erps-tab-transition-duration: 0.3s;
$erps-tab-transition-duration-fast: 0.2s;
$erps-tab-transition-duration-glow: 0.6s;
$erps-tab-animation-duration-glow: 3s;
$erps-tab-animation-duration-fade: 0.3s;

// Transform values
$erps-tab-transform-hover-y: -2px;
$erps-tab-transform-active-y: -1px;
$erps-tab-transform-scale-hover: 1.1;
$erps-tab-transform-fade-y: 10px;

// Z-index values
$erps-tab-z-index-base: 0;
$erps-tab-z-index-content: 1;
$erps-tab-z-index-active: 10;

// Opacity values
$erps-tab-opacity-icon: 0.8;
$erps-tab-opacity-icon-active: 1;
$erps-tab-opacity-glow-start: 0.2;
$erps-tab-opacity-glow-mid: 0.4;
$erps-tab-opacity-glow-before: 0.3;
$erps-tab-opacity-unequipped: 0.95;

// Background opacity values (using valid theme system values)
$erps-tab-bg-opacity-base: 10;
$erps-tab-bg-opacity-hover: 20;
$erps-tab-bg-opacity-active: 20;
$erps-tab-bg-opacity-count: 10;

// Pattern and background sizes
$erps-tab-glow-width: 200%;
$erps-tab-glow-position-start: -100%;
$erps-tab-glow-position-end: 100%;
$erps-tab-glow-position-center: 0%;

// Badge/count styling
$erps-tab-count-min-width: 1.5rem;
$erps-tab-count-height: 1.5rem;
$erps-tab-count-padding: 0 0.5rem;
$erps-tab-count-border-radius: 12px;
$erps-tab-count-font-size: 12pt;
$erps-tab-count-font-weight: 700;

// Icon sizes
$erps-tab-icon-size: 16pt;

// Gradient stop positions
$erps-tab-gradient-start: 0%;
$erps-tab-gradient-mid: 50%;
$erps-tab-gradient-end: 100%;

// Inset values for box shadows
$erps-tab-inset-border: 1px;
$erps-tab-inset-accent: 4px;

// Line height values
$erps-tab-line-height-badge: 1;

// Animation opacity values
$erps-tab-animation-opacity-start: 0;
$erps-tab-animation-opacity-end: 1;

// Position values
$erps-tab-position-top: 0;
$erps-tab-position-zero: 0;
$erps-tab-margin-zero: 0;
$erps-tab-width-full: 100%;

// Border radius variants for tab containers
$erps-tab-border-radius-top-only: $erps-tab-border-radius $erps-tab-border-radius 0 0;
$erps-tab-border-radius-full: $erps-tab-border-radius;
$erps-tab-border-radius-none: 0;

// ===================================
// MODERN COLOR FUNCTIONS & UTILITIES
// ===================================

// Utility mixins for tab-specific patterns
@mixin tab-glow($color, $opacity: 60) {
  box-shadow: 0 0 $erps-tab-shadow-blur-large themes.get-semantic-color($color, $opacity) !important;
}

@mixin tab-shadow-base {
  box-shadow: 0 4px $erps-tab-shadow-blur themes.get-universal-color(black, 30) !important;
}

@mixin tab-shadow-active($glow-color: var(--theme-glow)) {
  box-shadow:
    0 4px $erps-tab-shadow-blur themes.get-universal-color(black, 30),
    0 0 $erps-tab-shadow-blur-large $glow-color !important;
}

@mixin tab-gradient-background {
  background: linear-gradient(135deg,
    var(--theme-primary) $erps-tab-gradient-start,
    var(--theme-secondary) $erps-tab-gradient-mid,
    var(--theme-primary) $erps-tab-gradient-end) !important;
}

@mixin tab-animated-glow {
  content: '' !important;
  position: absolute !important;
  top: $erps-tab-position-top !important;
  left: $erps-tab-glow-position-start !important;
  width: $erps-tab-glow-width !important;
  height: $erps-tab-gradient-end !important;
  background: linear-gradient(90deg,
    transparent,
    themes.get-universal-color(white, 10),
    transparent) !important;
  transition: left $erps-tab-transition-duration-glow ease !important;
  z-index: $erps-tab-z-index-base !important;
}

// ===================================
// TAB CONTAINER BORDER RADIUS UTILITIES
// ===================================

// Tab container border radius variants
@mixin tab-container-radius-top-only {
  border-radius: $erps-tab-border-radius-top-only !important;
}

@mixin tab-container-radius-full {
  border-radius: $erps-tab-border-radius-full !important;
}

@mixin tab-container-radius-none {
  border-radius: $erps-tab-border-radius-none !important;
}

// ===================================
// CORE MIXINS FOR TABS
// ===================================

// Base tab container styling
@mixin tab-container-base {
  @include themes.apply-all-themes('tab-theme');

  display: flex !important;
  flex-wrap: wrap !important;
  border-bottom: $erps-tab-border-width-thick solid themes.get-universal-color(white, 10) !important;

  @include tab-gradient-background;
  @include tab-container-radius-top-only; // Default: rounded top, flat bottom

  padding: $erps-tab-padding-container !important;
  margin: $erps-tab-margin-zero !important;

  @include themes.themed-glow-shadow;
}

// Base tab item styling
@mixin tab-item-base {
  position: relative !important;
  padding: $erps-tab-padding !important;
  border: $erps-tab-border-width solid themes.get-universal-color(white, 20) !important;
  border-bottom: none !important;
  border-radius: $erps-tab-border-radius $erps-tab-border-radius 0 0 !important;
  font-family: var(--erps-ui-font) !important;
  font-size: $erps-tab-font-size !important;
  font-weight: $erps-tab-font-weight !important;
  text-transform: uppercase !important;
  letter-spacing: $erps-tab-letter-spacing !important;
  color: var(--theme-text, #fff) !important;
  background: themes.get-universal-color(white, $erps-tab-bg-opacity-base) !important;
  transition: all $erps-tab-transition-duration ease !important;
  text-decoration: none !important;
  cursor: pointer !important;
  margin-right: $erps-tab-margin-right !important;
  overflow: hidden !important;

  // Animated background effect
  &::before {
    @include tab-animated-glow;
  }

  // Text content above background effect
  & > * {
    position: relative !important;
    z-index: $erps-tab-z-index-content !important;
  }
}

// Tab hover state
@mixin tab-hover-state {
  background: var(--theme-primary, #{themes.get-semantic-color(blue, dark-90)}) !important;
  border-color: var(--theme-light, #{themes.get-semantic-color(blue, 70)}) !important;
  color: var(--theme-text, #fff) !important;
  transform: translateY($erps-tab-transform-hover-y) !important;

  @include tab-shadow-base;

  &::before {
    left: $erps-tab-glow-position-end !important;
  }
}

// Tab active state
@mixin tab-active-state {
  background: var(--theme-secondary, #{themes.get-semantic-color(blue, 80)}) !important;
  border-color: var(--theme-glow, #{themes.get-semantic-color(blue, 60)}) !important;
  color: var(--theme-text, #fff) !important;

  @include tab-shadow-active(var(--theme-glow, #{themes.get-semantic-color(blue, 60)}));

  transform: translateY($erps-tab-transform-active-y) !important;
  z-index: $erps-tab-z-index-active !important;

  &::before {
    left: $erps-tab-glow-position-center !important;
    background: linear-gradient(90deg,
      var(--theme-light, #{themes.get-semantic-color(blue, 70)}),
      transparent,
      var(--theme-light, #{themes.get-semantic-color(blue, 70)})) !important;
    opacity: $erps-tab-opacity-glow-before !important;
    animation: erps-tab-glow $erps-tab-animation-duration-glow ease-in-out infinite !important;
  }

  // Remove the skewed background from global override
  &::after {
    display: none !important;
  }
}

// Custom tab button styling (for gear tabs)
@mixin custom-tab-button-base {
  display: flex !important;
  align-items: center !important;
  gap: $erps-tab-gap !important;
  padding: $erps-tab-padding-large !important;
  border: none !important;
  border-radius: $erps-tab-border-radius-large $erps-tab-border-radius-large 0 0 !important;
  background: themes.get-universal-color(white, $erps-tab-bg-opacity-base) !important;
  color: var(--theme-text, #fff) !important;
  cursor: pointer !important;
  transition: all $erps-tab-transition-duration ease !important;
  font-family: var(--erps-ui-font) !important;
  font-size: $erps-tab-font-size-large !important;
  font-weight: $erps-tab-font-weight !important;
  text-transform: uppercase !important;
  letter-spacing: $erps-tab-letter-spacing !important;
  position: relative !important;
  overflow: hidden !important;
  height: $erps-tab-height-large !important;
  min-height: $erps-tab-height-large !important;
  box-sizing: border-box !important;

  // Default theme variables
  --theme-primary: #{themes.get-semantic-color(blue, dark-90)};
  --theme-secondary: #{themes.get-semantic-color(blue, 80)};
  --theme-accent: #{themes.get-semantic-color(blue, dark-80)};
  --theme-light: #{themes.get-semantic-color(blue, 70)};
  --theme-glow: #{themes.get-semantic-color(blue, 60)};
  --theme-text: #fff;

  i {
    font-size: $erps-tab-icon-size !important;
    opacity: $erps-tab-opacity-icon !important;
    transition: all $erps-tab-transition-duration-fast ease !important;
  }

  &:hover i {
    opacity: $erps-tab-opacity-icon-active !important;
    transform: scale($erps-tab-transform-scale-hover) !important;
  }
}

// Tab content styling
@mixin tab-content-base {
  margin-top: $erps-tab-position-zero !important;
  padding-top: $erps-tab-position-zero !important;

  // Remove top margin from first data section in each tab
  .eventide-actor-data-section:first-child {
    margin-top: $erps-tab-position-zero !important;
  }
}

@mixin tab-content-scrollable {
  height: $erps-tab-content-height-scrollable !important;
  overflow-y: auto !important;

  // Ensure all sections don't scroll individually
  section.main, aside.sidebar, .items-list {
    overflow: visible !important;
  }
}

@mixin tab-content-animated {
  display: none !important;
  width: $erps-tab-width-full !important;
  animation: erps-tab-fade-in $erps-tab-animation-duration-fade ease-in-out !important;

  &.active {
    display: block !important;
  }
}

// Count/badge styling for custom tabs
@mixin tab-count-badge {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  min-width: $erps-tab-count-min-width !important;
  height: $erps-tab-count-height !important;
  padding: $erps-tab-count-padding !important;
  border-radius: $erps-tab-count-border-radius !important;
  background: themes.get-universal-color(white, $erps-tab-bg-opacity-count) !important;
  font-size: $erps-tab-count-font-size !important;
  font-weight: $erps-tab-count-font-weight !important;
  line-height: $erps-tab-line-height-badge !important;
}

// ===================================
// MAIN COMPONENT
// ===================================

.erps-tabs {
  // Standard Foundry tab container
  &__container {
    @include tab-container-base;

    // Override global tab styling with higher specificity
    &.sheet-tabs,
    .tabs {
      @include tab-container-base;
    }

    // Manual border radius overrides
    &--radius-top-only {
      @include tab-container-radius-top-only;
    }

    &--radius-full {
      @include tab-container-radius-full;
    }

    &--radius-none {
      @include tab-container-radius-none;
    }
  }

  // Standard tab items
  &__item {
    @include tab-item-base;

    // Font styling for tab text
    .item {
      font-family: var(--erps-ui-font) !important;
      font-weight: $erps-tab-font-weight !important;
      letter-spacing: $erps-tab-letter-spacing !important;
    }

    // Hover state
    &:hover:not(.active) {
      @include tab-hover-state;
    }

    // Active state
    &.active {
      @include tab-active-state;
    }
  }

  // Tab content areas
  &__content {
    @include tab-content-base;

    // Scrollable variant
    &--scrollable {
      @include tab-content-scrollable;
    }
  }

  // Custom tab navigation (for gear tabs, etc.)
  &__nav {
    display: flex !important;
    gap: $erps-tab-gap !important;
    margin-bottom: $erps-tab-nav-margin-bottom !important;
    border-bottom: $erps-tab-border-width-thick solid themes.get-universal-color(white, 10) !important;
    padding-bottom: $erps-tab-nav-padding-bottom !important;
  }

  // Custom tab buttons
  &__button {
    @include custom-tab-button-base;

    // Equipped variant icon styling (must come before active state)
    &--equipped i {
      color: themes.get-semantic-color(green, 90) !important;
    }

    // Unequipped variant icon styling (must come before active state)
    &--unequipped i {
      color: themes.get-semantic-color(gray, 90) !important;
    }

    // Hover state
    &:hover {
      background: var(--theme-primary) !important;
      transform: translateY($erps-tab-transform-hover-y) !important;

      @include tab-shadow-base;

      .erps-tabs__count {
        background: themes.get-universal-color(white, $erps-tab-bg-opacity-hover) !important;
      }
    }

    // Active state
    &.active {
      background: var(--theme-secondary) !important;

      @include tab-shadow-active(var(--theme-glow));

      transform: translateY($erps-tab-transform-active-y) !important;

      .erps-tabs__count {
        background: themes.get-universal-color(white, $erps-tab-bg-opacity-active) !important;
        box-shadow: 0 0 $erps-tab-shadow-blur-small themes.get-universal-color(white, 20) !important;
      }
    }

    // Active state icon styling (must come after variant icon styling)
    &.active i {
      opacity: $erps-tab-opacity-icon-active !important;
      text-shadow: 0 0 $erps-tab-shadow-blur-small var(--theme-glow) !important;
    }

    // Equipped variant theme overrides
    &--equipped {
      &.active, &:hover {
        --theme-primary: #{themes.get-semantic-color(green, dark-90)};
        --theme-secondary: #{themes.get-semantic-color(green, 80)};
        --theme-glow: #{themes.get-semantic-color(green, 60)};
      }
    }

    // Unequipped variant theme overrides
    &--unequipped {
      &.active, &:hover {
        --theme-primary: #{themes.get-semantic-color(gray, 90)};
        --theme-secondary: #{themes.get-semantic-color(gray, 80)};
        --theme-glow: #{themes.get-semantic-color(gray, 60)};
      }
    }
  }

  // Count/badge for custom tabs
  &__count {
    @include tab-count-badge;
  }

  // Custom tab content with animation
  &__panel {
    @include tab-content-animated;

    // Equipped content styling
    &--equipped {
      .eventide-actor-data-table, .erps-data-table {
        border-left: $erps-tab-border-width-accent solid themes.get-semantic-color(green, 60) !important;
        box-shadow:
          0 $erps-tab-border-width-accent $erps-tab-shadow-blur themes.get-universal-color(black, 30),
          inset 0 $erps-tab-inset-border 0 themes.get-universal-color(white, 10),
          inset $erps-tab-inset-accent 0 0 themes.get-semantic-color(green, 20) !important;
      }
    }

    // Unequipped content styling
    &--unequipped {
      .eventide-actor-data-table, .erps-data-table {
        border-left: $erps-tab-border-width-accent solid themes.get-semantic-color(gray, 40) !important;
        opacity: $erps-tab-opacity-unequipped !important;
        box-shadow:
          0 $erps-tab-border-width-accent $erps-tab-shadow-blur themes.get-universal-color(black, 30),
          inset 0 $erps-tab-inset-border 0 themes.get-universal-color(white, 10),
          inset $erps-tab-inset-accent 0 0 themes.get-semantic-color(gray, 15) !important;
      }
    }
  }

  // Light theme overrides
  &--light {
    .erps-tabs__button {
      color: themes.get-universal-color(black, 80) !important;

      .erps-tabs__count {
        background: themes.get-universal-color(black, 30) !important;
        color: themes.get-universal-color(black, 80) !important;
      }

      &:hover .erps-tabs__count {
        background: themes.get-universal-color(black, 30) !important;
      }

      &.active .erps-tabs__count {
        background: themes.get-universal-color(black, 30) !important;
        color: themes.get-universal-color(black, 80) !important;
      }
    }
  }
}

// ===================================
// DYNAMIC TAB CONTAINER STYLING
// ===================================

// JavaScript-driven tab container styling based on active tab
// These classes are applied dynamically by the tab-container-styling.mjs module

.eventide-character-sheet {
  // Rounded container for tabs with custom navigation or standalone content
  .tabs.erps-tabs__container--rounded,
  .sheet-tabs.erps-tabs__container--rounded {
    @include tab-container-radius-full;

    margin-bottom: $erps-tab-nav-margin-bottom !important;
  }

  // Flat container for tabs that connect directly to data tables
  .tabs.erps-tabs__container--flat,
  .sheet-tabs.erps-tabs__container--flat {
    @include tab-container-radius-top-only;

    margin-bottom: $erps-tab-position-zero !important;
  }

  // Legacy static selectors (kept for fallback compatibility)
  // These will be overridden by the JavaScript-driven classes above

  // Gear tab gets full rounding since it has its own navigation
  .tab[data-tab="gear"] {
    .tabs,
    .sheet-tabs,
    .erps-tabs__container {
      border-radius: $erps-tab-border-radius-full !important;
      margin-bottom: $erps-tab-nav-margin-bottom !important;
    }
  }

  // Manual override classes for specific use cases
  .tab--rounded-container {
    .tabs,
    .sheet-tabs,
    .erps-tabs__container {
      border-radius: $erps-tab-border-radius-full !important;
    }
  }

  .tab--flat-container {
    .tabs,
    .sheet-tabs,
    .erps-tabs__container {
      border-radius: $erps-tab-border-radius-top-only !important;
    }
  }
}

// ===================================
// LEGACY SELECTORS FOR COMPATIBILITY
// ===================================
// These maintain compatibility with existing character sheet markup

.eventide-character-sheet {
  // Tab navigation - themed overrides with high specificity
  .tabs .item {
    font-family: var(--erps-ui-font) !important;
    font-weight: $erps-tab-font-weight !important;
    letter-spacing: $erps-tab-letter-spacing !important;
  }

  // Themed tab system - override global tab styling with important declarations
  &.sheet-tabs,
  .tabs {
    @include tab-container-base;
  }

  // Themed tab items - base selector first, then more specific ones
  .tabs a[data-action="tab"] {
    @include tab-item-base;

    &:hover:not(.active) {
      @include tab-hover-state;
    }

    &.active {
      @include tab-active-state;
    }
  }

  // More specific selector for sheet tabs: uncomment if required
  // .sheet-tabs.tabs a[data-action="tab"] {
  //   // Inherits all styles from above, can add specific overrides here if needed
  // }

  // Scrollable tabs modifier
  &--scrollbars {
    .tab {
      @include tab-content-scrollable;
    }
  }

  // Tab content styling
  .tab {
    @include tab-content-base;
  }

  // Theme-specific text color overrides for gear tab buttons
  &[data-bg-theme="light"] .gear-tab-button {
    color: themes.get-universal-color(black, 80) !important;

    .gear-count {
      background: themes.get-universal-color(black, 30) !important;
      color: themes.get-universal-color(black, 80) !important;
    }

    &:hover .gear-count {
      background: themes.get-universal-color(black, 30) !important;
    }

    &.active .gear-count {
      background: themes.get-universal-color(black, 30) !important;
      color: themes.get-universal-color(black, 80) !important;
    }
  }
}

// Gear tab system (legacy selectors)
.gear-tab-nav {
  display: flex !important;
  gap: $erps-tab-gap !important;
  margin-bottom: $erps-tab-nav-margin-bottom !important;
  border-bottom: $erps-tab-border-width-thick solid themes.get-universal-color(white, 10) !important;
  padding-bottom: $erps-tab-nav-padding-bottom !important;
}

.gear-tab-button {
  @include custom-tab-button-base;

  // Equipped gear button icon styling (must come before active state)
  &--equipped i {
    color: themes.get-semantic-color(green, 90) !important;
  }

  // Unequipped gear button icon styling (must come before active state)
  &--unequipped i {
    color: themes.get-semantic-color(gray, 90) !important;
  }

  &:hover {
    background: var(--theme-primary) !important;
    transform: translateY($erps-tab-transform-hover-y) !important;

    @include tab-shadow-base;

    .gear-count {
      background: themes.get-universal-color(white, $erps-tab-bg-opacity-hover) !important;
    }
  }

  &.active {
    background: var(--theme-secondary) !important;

    @include tab-shadow-active(var(--theme-glow));

    transform: translateY($erps-tab-transform-active-y) !important;

    .gear-count {
      background: themes.get-universal-color(white, $erps-tab-bg-opacity-active) !important;
      box-shadow: 0 0 $erps-tab-shadow-blur-small themes.get-universal-color(white, 20) !important;
    }
  }

  // Active state icon styling (inherits from custom-tab-button-base mixin)
  &.active i {
    opacity: $erps-tab-opacity-icon-active !important;
    text-shadow: 0 0 $erps-tab-shadow-blur-small var(--theme-glow) !important;
  }

  // Equipped gear button theme overrides
  &--equipped {
    &.active, &:hover {
      --theme-primary: #{themes.get-semantic-color(green, dark-90)};
      --theme-secondary: #{themes.get-semantic-color(green, 80)};
      --theme-glow: #{themes.get-semantic-color(green, 60)};
    }
  }

  // Unequipped gear button theme overrides
  &--unequipped {
    &.active, &:hover {
      --theme-primary: #{themes.get-semantic-color(gray, 90)};
      --theme-secondary: #{themes.get-semantic-color(gray, 80)};
      --theme-glow: #{themes.get-semantic-color(gray, 60)};
    }
  }

  .gear-count {
    @include tab-count-badge;
  }
}

// Gear tab content
.gear-tab-content {
  @include tab-content-animated;

  // Equipped gear content styling
  &--equipped {
    .eventide-actor-data-table {
      border-left: $erps-tab-border-width-accent solid themes.get-semantic-color(green, 60) !important;
      box-shadow:
        0 $erps-tab-border-width-accent $erps-tab-shadow-blur themes.get-universal-color(black, 30),
        inset 0 $erps-tab-inset-border 0 themes.get-universal-color(white, 10),
        inset $erps-tab-inset-accent 0 0 themes.get-semantic-color(green, 20) !important;
    }
  }

  // Unequipped gear content styling
  &--unequipped {
    .eventide-actor-data-table {
      border-left: $erps-tab-border-width-accent solid themes.get-semantic-color(gray, 40) !important;
      opacity: $erps-tab-opacity-unequipped !important;
      box-shadow:
        0 $erps-tab-border-width-accent $erps-tab-shadow-blur themes.get-universal-color(black, 30),
        inset 0 $erps-tab-inset-border 0 themes.get-universal-color(white, 10),
        inset $erps-tab-inset-accent 0 0 themes.get-semantic-color(gray, 15) !important;
    }
  }
}

// ===================================
// ANIMATIONS
// ===================================

@keyframes erps-tab-glow {
  0%, 100% {
    opacity: $erps-tab-opacity-glow-start;
  }

  50% {
    opacity: $erps-tab-opacity-glow-mid;
  }
}

@keyframes erps-tab-fade-in {
  from {
    opacity: $erps-tab-animation-opacity-start;
    transform: translateY($erps-tab-transform-fade-y);
  }

  to {
    opacity: $erps-tab-animation-opacity-end;
    transform: translateY($erps-tab-position-zero);
  }
}
