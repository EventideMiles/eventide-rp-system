# v13.21.0 - Action Card Enhancements & Quality of Life

**Release Date**: February 2026

## Major Features

### üéØ Stat Points Formula & Color-Coded Stat Total

A new configurable formula system for calculating stat points with visual feedback to help players and GMs quickly assess character stat allocation.

**Configurable Formula**

- **Stat Points Formula**: Customizable formula in System Settings for calculating total stat points
- **Flexible Calculation**: Supports complex formulas using stat references (e.g., `@acro.total + @phys.total + @fort.total`)
- **Per-Character Override**: Individual characters can override the system formula if needed

**Color-Coded Visual Feedback**

The stat total display now provides immediate visual feedback based on allocation status:

- **Green**: Stat total is below formula result: meaning you can add more points (under allocated)
- **Grey**: Formula is disabled or satisfied (no validation active OR properly allocated)
- **Red**: Stat total doesn't match the formula result (over allocated)

**Benefits**

- Quick visual confirmation of character stat validity
- Helps prevent accidental stat allocation errors
- Supports different game systems with varying stat point requirements
- GMs can enforce stat point balance across their campaign

### üéØ Self-Target Action Card Toggle

Action cards can now be configured to automatically target the user, streamlining self-buff and self-healing actions.

**Automatic Self-Targeting**

- **Self-Target Toggle**: New checkbox on action cards to enable automatic self-targeting
- **Streamlined Workflow**: Self-buff cards no longer require manual target selection
- **Smart Behavior**: When enabled, the action card automatically targets the executing character

**Use Cases**

- Self-healing abilities
- Self-buff spells and powers
- Stance or form changes
- Any action that should only affect the user

**UI Integration**

- Toggle appears in the action card configuration interface
- Clear visual indication when self-target is enabled
- Works seamlessly with existing action card execution flow

### üéØ Enforce Status Choice

New validation prevents selection of multiple status effects when an action card should only apply one.

**Single Status Enforcement**

- **Validation Logic**: System now enforces single status selection when appropriate
- **Prevents Errors**: Stops users from accidentally selecting multiple conflicting status effects
- **Clear Feedback**: Users receive immediate notification if they attempt to select multiple statuses

**Benefits**

- Reduces user errors during action card configuration
- Ensures intended behavior for status application
- Improves data integrity for action cards

## Bug Fixes

### üêõ Character Effect Default Mode

**Issue**: Character effects were defaulting to OVERRIDE mode instead of ADD mode.

**Fix**: Corrected the default mode to ADD, which is the appropriate default for most character effects.

**Impact**: New character effects will now properly default to additive behavior, preventing unintended stat overrides.

### üêõ Context Menu Flicker

**Issue**: Opening a context menu while another context menu was already open caused visual flickering.

**Fix**: Implemented partial mitigation to reduce flickering in common scenarios.

**Known Limitations**: This fix addresses the most common occurrences but may not completely eliminate flickering in all edge cases. See the Known Issues section below for details.

## Getting Started

### For Players

**Using the Stat Points Formula**

- Check your character sheet stat total display for color-coded feedback
- Green indicates your stats are properly allocated according to the formula
- Red indicates you may need to adjust your stat allocation
- Contact your GM if you believe the formula needs adjustment for your character

**Configuring Self-Target Action Cards**

- Edit your action cards and look for the "Self-Target" checkbox
- Enable this toggle for abilities that should only affect you
- Save the action card and it will automatically target you when executed

### For Game Masters

**Setting Up Stat Points Formula**

- Access System Settings and locate the "Stat Points Formula" option
- Enter a formula using stat references (e.g., `@phys.total + @acro.total + @will.total`)
- Leave empty to disable validation
- Players will see color-coded feedback on their character sheets

**Managing Action Card Configuration**

- Review existing action cards that may benefit from self-target toggle
- Enable self-target for self-buff and self-healing abilities
- The enforce status choice feature works automatically to prevent errors

## Known Issues

### Context Menu Flicker

**Description**: Opening a context menu while another context menu is already open may cause visual flickering.

**Impact**: This is a visual issue that doesn't affect functionality but may be momentarily distracting.

**Workaround**: Close existing context menus before opening new ones when possible.

**Status**: This edge case was deemed impractical to fully resolve. The partial fix addresses the most common scenarios. Future updates may include additional improvements as better solutions become available.

## Version Information

- **Release Version**: 13.21.0
- **Foundry Compatibility**: v13+ minimum, v13+ verified
- **Major Features**: Stat Points Formula, Self-Target Toggle, Enforce Status Choice
- **Previous Version**: v13.20.0 introduced Documentation Overhaul & Derived Value System

## Documentation

- [Action Cards Guide](../advanced-usage/action-cards.md) - Complete action cards documentation
- [Status Effects Guide](../system-features/status-effects.md) - Status effect system reference
- [Character Creation Guide](../for-players/character-creation.md) - Character creation and stat allocation
