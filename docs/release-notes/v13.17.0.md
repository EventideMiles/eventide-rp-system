# v13.17.0 - Transformation to Actor Conversion

**Release Date**: November 2025

## Major Features and Improvements

### ðŸ”„ Bidirectional Transformation-Actor Conversion

**Transformations and actors can now be converted between each other, enabling flexible character and creature management.**

#### Transformation to Actor Conversion

- **Create Actors from Transformations**: Convert any transformation into a full actor
- **Preserve All Data**: Action cards, combat powers, features, and other embedded items transfer completely
- **Actor Type Selection**: Choose between character or NPC when creating the actor
- **Flexible Destination**: Create in world, compendium, or specific folders
- **Macro Interface**: User-friendly macro provides guided conversion process

#### Actor to Transformation Conversion

- **Create Transformations from Actors**: Turn any actor into a reusable transformation
- **Full Data Transfer**: All relavant actor items, stats, and configurations transfer to the transformation
- **Template Creation**: Build transformation templates from existing characters
- **Compendium Support**: Save conversions directly to compendia for sharing
- **Macro Interface**: Intuitive macro makes conversion simple and straightforward

#### Conversion Features

- **Name Customization**: Specify custom names during conversion or use the source name
- **Source Tracking**: Conversions note their source (World, Compendium name, etc.)
- **Smart Defaults**: Sensible default selections make conversion quick
- **Validation**: Built-in validation ensures conversions complete successfully
- **User Feedback**: Clear success messages with next steps after conversion

### ðŸ–±ï¸ Drag and Drop Actor Transformation

**New drag-and-drop workflow for quick transformations between actors.**

#### Drag to Transform

- **Actor on Actor**: Drag one actor onto another's sheet to apply as a transformation
- **Automatic Conversion**: System automatically converts the dragged actor to a transformation
- **Apply Immediately**: Transformation applies to the target actor right away
- **Quick Workflow**: Fastest way to transform one character into another
- **Visual Feedback**: Clear feedback during the drag-and-drop operation

#### Use Cases

- **Polymorph Effects**: Quickly transform characters into creatures
- **Shape-shifting**: Apply shape-shift forms by dragging creature actors
- **Disguise**: Transform actors to look like other characters
- **Possession**: Swap character appearances and abilities
- **GM Shortcuts**: Rapidly apply transformation effects during gameplay

### ðŸ› ï¸ Conversion Macros

**Two new macros provide easy access to conversion functionality.**

#### Transformation to Actor Macro

- **Select Transformation**: Choose from all available transformations (world + compendia)
- **Configure Actor**: Set name, type, and destination
- **One-Click Convert**: Simple form interface handles the entire process
- **Source Display**: See which compendium or source contains each transformation

#### Actor to Transformation Macro

- **Select Actor**: Choose from all available actors (world + compendia)
- **Configure Transformation**: Set name and destination
- **One-Click Convert**: Quick conversion with all data preserved
- **Source Display**: Clear indication of where each actor comes from

### ðŸ”§ Size Calculation Improvements

**Enhanced size calculation formulas for transformation conversions.**

#### Size Handling

- **Accurate Transfers**: Character sizes convert accurately between actors and transformations
- **Formula Updates**: Improved size calculation formulae for edge cases
- **Token Size**: Proper token size settings transfer during conversion
- **Grid Scale**: Token grid scale maintained during conversion

### ðŸ“š Migration Support

**Migration script ensures compatibility with older transformation data.**

#### One-Time Migration

- **Automatic Detection**: System detects transformations using old data format
- **Safe Migration**: Non-destructive migration preserves all existing data
- **User Notification**: Clear notification when migration is needed
- **Run Once**: Migration only needed if you used versions prior to v13.17.0
- **All Set**: After migration, transformations work seamlessly with new features

#### What Gets Migrated

- **Data Structure**: Updates transformation data to new format
- **Embedded Items**: Ensures embedded items use current structure
- **Flags and Metadata**: Migrates system flags to new schema
- **Action Cards**: Updates action card references if needed

## Getting Started

### For Players

1. **Use Drag-and-Drop**: Drag actor tokens onto character sheets to transform them
2. **Convert Your Forms**: Turn shapeshifting forms into reusable transformations
3. **Build Templates**: Create transformation templates from favorite creature actors
4. **Quick Polymorph**: Use drag-and-drop for instant polymorph effects during gameplay

### For Game Masters

1. **Run Migration**: If using pre-v13.17.0 transformations, run the migration macro once
2. **Build Libraries**: Convert creature actors to transformations for your compendium
3. **Quick NPCs**: Convert transformations to actors for one-off NPCs
4. **Share Content**: Create transformation compendia from your world's actors
5. **Drag-and-Drop Magic**: Use drag-and-drop for quick magical transformation effects

### Conversion Workflow Examples

#### Creating a Werewolf Transformation

1. Design your werewolf as a full actor with all abilities
2. Run "Actor to Transformation" macro
3. Select your werewolf actor
4. Name it "Werewolf Form"
5. Save to world or compendium
6. Apply to player characters as needed

#### Creating an NPC from a Template

1. Run "Transformation to Actor" macro
2. Select your template transformation (e.g., "City Guard")
3. Name the NPC (e.g., "Guard Marcus")
4. Select NPC type
5. Create in world
6. Customize the new NPC as needed

#### Quick Combat Transformation

1. Drag a beast actor onto a druid's character sheet
2. System converts the beast to a transformation automatically
3. Transformation applies immediately
4. Druid now has beast statistics and abilities
5. Remove transformation when wild shape ends

## Migration and Compatibility

### Required Migration

**If you used transformations in v13.16.0 or earlier:**

1. Open the migration macro from the ERPS Macros compendium
2. Run the macro once
3. Wait for confirmation that migration completed
4. All transformations now work with the conversion features

**If you're new to v13.17.0 or later:**

- No migration needed
- All features work immediately
- Start using conversions right away

### Data Safety

- **Non-Destructive**: Migration and conversions never delete original data
- **Preserves Originals**: Source actors/transformations remain unchanged
- **Backup Recommended**: Always backup before major version updates
- **Tested**: Extensive testing ensures data integrity during conversions

## Version Information

- **Release Version**: 13.17.0
- **Foundry Compatibility**: v13+ minimum, v13+ verified
- **Major Features**: Transformation-Actor Conversion, Drag-and-Drop Transformation, Migration Support
- **Previous Version**: v13.16.0 introduced Action Card Groups

## Known Issues

None at this time. The conversion system has been thoroughly tested.

## Documentation

- [Transformation System](../advanced-usage/transformations.md) - Complete transformation documentation
- [Action Cards Guide](../advanced-usage/action-cards.md) - Action cards work with converted actors
- [Quick Start Guide](../getting-started/quick-start.md) - Get started with the system

## Technical Details

### For Developers

#### Conversion API

The conversion system provides these key functions:

- `TransformationConverter.toActor(transformation, options)` - Convert transformation to actor
- `ActorConverter.toTransformation(actor, options)` - Convert actor to transformation
- Both return promises that resolve with the created document

#### Options Structure

```javascript
{
  name: "Custom Name",           // Optional: defaults to source name
  actorType: "character",        // For transformation->actor only
  folder: folderId,              // Optional: target folder
  pack: "compendium.name"        // Optional: target compendium
}
```

#### Drag-and-Drop Integration

The drag-and-drop transformation uses the standard Foundry drop handlers:

- `_onDropActor(event, data)` - Handles actor drops on actor sheets
- Automatically triggers conversion if needed
- Applies transformation to target actor
- Provides user feedback through UI notifications

#### Migration Script Structure

- Migration detected via version flag comparison
- Uses `game.system.version` to determine if migration needed
- Updates all transformation documents in world and compendia
- Sets migration flag to prevent re-running

#### Data Preserved During Conversion

**Actor â†’ Transformation:**

- All embedded items (features, gear, combat powers, action cards)
- Character effects and transformations
- Image and token configuration
- Description and biography
- Custom attributes and flags

**Transformation â†’ Actor:**

- All embedded items
- Transformation configuration (converted to features where applicable)
- Image and token settings
- Description text
- Size and physical attributes

#### Size Calculation Formula

Size values map between actor and transformation formats:

- Tiny â†’ 0.5 grid units
- Small â†’ 0.8 grid units
- Medium â†’ 1 grid unit
- Large â†’ 2 grid units
- Huge â†’ 3 grid units
- Gargantuan â†’ 4 grid units

### CSS and Templates

#### New Templates

- `templates/macros/transformation-to-actor-converter.hbs` - Transformation conversion form
- `templates/macros/actor-to-transformation-converter.hbs` - Actor conversion form

#### Form Elements

- Dropdown for source selection
- Text input for custom naming
- Select for actor type (transformation â†’ actor only)
- Select for destination (world/compendium)
- Optional compendium ID input

### Translation Keys

New translation keys added for conversion features:

- `EVENTIDE_RP_SYSTEM.Forms.Labels.SelectTransformation`
- `EVENTIDE_RP_SYSTEM.Forms.Labels.SelectActor`
- `EVENTIDE_RP_SYSTEM.Forms.Labels.ActorName`
- `EVENTIDE_RP_SYSTEM.Forms.Labels.TransformationName`
- `EVENTIDE_RP_SYSTEM.Forms.Labels.ActorType`
- `EVENTIDE_RP_SYSTEM.Forms.Labels.CreateIn`
- `EVENTIDE_RP_SYSTEM.Forms.Labels.CompendiumId`

## Future Enhancements

### Potential Additions

- Batch conversion for multiple actors/transformations
- Conversion presets for common workflows
- Advanced filtering options in conversion macros
- Partial conversion (select which items to transfer)
- Conversion history tracking

### Community Feedback

We welcome feedback on the conversion system:

- Workflow improvements
- Additional conversion options
- UI/UX enhancements
- Integration with other features

---

**Current Version**: v13.17.0 | **Foundry VTT Compatibility**: v13+ | **Last Updated**: November 2025
