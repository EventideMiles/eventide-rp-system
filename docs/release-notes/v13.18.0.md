# v13.18.0 - GM Action Cards

**Release Date**: January 2026

## New Features

### ðŸŽ­ GM Action Cards System

**Game Masters can now create and manage action cards that are completely hidden from players.**

GM Action Cards are specifically designed for situations where the GM wants to apply mechanics that should never be visible to players, such as:

- Secret NPC abilities (e.g., a vampire choosing between drinking blood or kissing).
- Character-specific effects (e.g., a player taking damage from a trap without knowing its source).
- Environmental effects (e.g., a hidden trap or weather effect).
- Plot mechanics that require GM control (e.g., a hidden countdown timer for a dramatic reveal).

#### Core Functionality

- **Dedicated GM Actions Tab**: New tab on character sheets visible only to GMs (Assistant GM permission or higher).
- **Complete Player Isolation**: GM action cards never appear in player views, even on their own characters.
- **Transformation Protection**: GM action cards are automatically filtered out of transformations to prevent accidental player visibility.
- **Execution Permissions**: Only GMs can execute GM-only action cards, with automatic permission checks.
- **Visual Indicators**: Eye-slash icon (fa-eye-slash) clearly marks the GM Actions tab.

#### Smart Context-Aware Creation

The system intelligently detects which tab is active when creating or dropping action cards:

- **Drop on GM Actions Tab**: Automatically sets the `gmOnly` flag to `true`.
- **Drop on Regular Tab**: Automatically sets the `gmOnly` flag to `false`.
- **Create Button Integration**: "New Item" button in GM Actions tab creates GM-only cards by default.
- **Drag Between Tabs**: Moving action cards between tabs automatically updates their GM-only status.
- **Manual Toggle**: GM Only checkbox in action card configuration allows manual override.

#### Use Cases

**Secret NPC Abilities**

- Hidden special attacks that shouldn't be telegraphed to players.
- Transformation abilities that trigger under specific conditions.
- Backup tactics that activate when NPCs reach certain health thresholds.

**Environmental Effects**

- Automated hazards in dungeons and dangerous locations.
- Weather effects that trigger periodically.
- Traps that activate when specific conditions are met.

**Plot Mechanics**

- Story-driven effects that need to remain secret.
- Surprise reinforcements or enemy abilities.
- Hidden countdown timers for dramatic reveals.

**Testing & Development**

- Test action cards without exposing them to players.
- Experimental mechanics that aren't ready for player use.
- Quick debugging of action card configurations.

#### Technical Implementation

**Data Model Changes**

- Added `gmOnly` boolean field to action card schema ([item-action-card.mjs:281-284](../module/data/item-action-card.mjs)).
- Default value: `false` (maintains backward compatibility).
- Required field with proper validation.

**UI Components**

- New GM Actions tab template ([gm-action-cards.hbs](../templates/actor/gm-action-cards.hbs)).
- GM Only toggle in action card attributes ([action-card.hbs:65-84](../templates/item/attribute-parts/action-card.hbs)).
- Conditional sheet width expansion for GMs (880px â†’ 1020px).
- Tab positioning next to regular Action Cards for easy access.

**Permission System**

- Permission checks in action card execution methods.
- GM-only filtering in transformation system ([actor-transformation.mjs](../module/documents/mixins/actor-transformation.mjs)).
- Context preparation splits cards into regular and GM arrays ([actor-sheet-context-preparation.mjs](../module/ui/mixins/actor-sheet-context-preparation.mjs)).
- Grouping support for GM action cards with full drag-drop functionality.

**Smart Drag-Drop Logic**

- Active tab detection using dual approach (tabGroups + DOM check).
- Automatic `gmOnly` flag setting based on drop target tab.
- Plain object conversion to handle DataModel instances correctly.
- Tab-switching updates for existing action cards ([actor-sheet-drag-drop.mjs:405-417](../module/ui/mixins/actor-sheet-drag-drop.mjs)).

#### Localization

**New Translation Keys** (added to `lang/src/en/actor.json` and `item.json`):

```json
// Actor sheet
"EVENTIDE_RP_SYSTEM.Actor.Tabs.GmActions": "GM Actions"
"EVENTIDE_RP_SYSTEM.Actor.ActionCards.NoGmCards": "No GM action cards configured"

// Item configuration
"EVENTIDE_RP_SYSTEM.Item.ActionCard.GmOnly.label": "GM Only"
"EVENTIDE_RP_SYSTEM.Item.ActionCard.GmOnly.hint": "This action card is only visible and executable by GMs"
```

#### Backward Compatibility

- Existing action cards automatically default to `gmOnly: false`.
- No migration required - new field is optional with safe default.
- Existing functionality completely unaffected.
- All action card groups and transformations continue working normally.
